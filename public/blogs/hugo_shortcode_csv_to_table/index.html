<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />



<title>Custom Hugo shortcode to render tables with images</title>




  <link rel="shortcut icon" href="/images/favicon.png" type="image/png" />


  <meta name="description" content="Step-by-step Hugo guide to render CSV tables with images using Age of Empires II Dataset Mining"
/>

  <meta name="keywords" content="Hugo shortcodes, Hugo templates, static site generator, custom shortcodes, built-in shortcodes, content creation, Markdown extensions, Go HTML templates, Hugo partials, dynamic content, Hugo functions, layout components, DRY principles, web development, content management, Hugo documentation, code examples, responsive embeds, customizable content, Hugo power features, Age of empires, Age of empires II, Age of empires 2, AOE2, AOE2API, AOE2TechTree, Cheatsheet"
/>
<meta name="referrer" content="no-referrer-when-downgrade" />

<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />











<link rel="stylesheet" href="/css/style.min.5225559b588c6dd9e2575685da1d0d3c6d059652c9b6dae2b54d59a14ad811ce.css" type="text/css" integrity="sha256-UiVVm1iMbdniV1aF2h0NPG0FllLJttritU1ZoUrYEc4=" />

<meta property="og:url" content="http://localhost:1313/blogs/hugo_shortcode_csv_to_table/">
  <meta property="og:site_name" content="J. Marinero - Data Scientist & AI Engineer">
  <meta property="og:title" content="Custom Hugo shortcode to render tables with images">
  <meta property="og:description" content="Step-by-step Hugo guide to render CSV tables with images using Age of Empires II Dataset Mining">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blogs">
    <meta property="og:image" content="http://localhost:1313/images/cover-image.jpg">


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/images/cover-image.jpg">
  <meta name="twitter:title" content="Custom Hugo shortcode to render tables with images">
  <meta name="twitter:description" content="Step-by-step Hugo guide to render CSV tables with images using Age of Empires II Dataset Mining">


  <meta itemprop="name" content="Custom Hugo shortcode to render tables with images">
  <meta itemprop="description" content="Step-by-step Hugo guide to render CSV tables with images using Age of Empires II Dataset Mining">
  <meta itemprop="wordCount" content="7624">
  <meta itemprop="image" content="http://localhost:1313/images/cover-image.jpg">
  <meta itemprop="keywords" content="Hugo shortcodes,Hugo templates,static site generator,custom shortcodes,built-in shortcodes,content creation,Markdown extensions,Go HTML templates,Hugo partials,dynamic content,Hugo functions,layout components,DRY principles,web development,content management,Hugo documentation,code examples,responsive embeds,customizable content,Hugo power features,Age of empires,Age of empires II,Age of empires 2,AOE2,AOE2API,AOE2TechTree,Cheatsheet">






<style>
:root {
    --cover-text-color: #246B9F;
    --highlight: #80A4BE;
    --cover-title-and-description-guard-bg-color: rgba(159, 208, 103, 0.7);
    --cover-title-text-shadow: white 0px 0px 12px;
    --sticky-menu-text-color: #246B9F;
    --section-dark-bg-color: #246B9F;
}
 
.post-holder.dark a:hover {
    color: rgba(159, 208, 103, 0.7) !important;
    text-decoration: underline;
}
 
.data-table {
  width: 100%; 
  border-collapse: collapse;
}
.data-cell {
  background-color: #6D9DBF;
  padding: 5%;
  vertical-align: middle;
}
.header-cell {
  background-color: #6D9DBF;
  width: 95%;
  text-align: center;
}
.image-cell {
  width: 45%;
}
.table-image {
  width: 100%; 
  display: block;
}
 
.circular-bg {
  background-color: #6D9DBF;
  clip-path: circle(50% at 50% 50%);  
  aspect-ratio: 1;  
  display: block;  
  margin: 0 auto;  
}

 
 
 
.no-underline-except-hover {
  text-decoration: none;     
  line-height: 1.5em;  
  display: block;  
  margin-bottom: 1.1em;  
}
.no-underline-except-hover:hover {
  text-decoration: underline;   
}

 
.blogs_index {
  margin-top: 1.5em;
  margin-bottom: 2.5em;
}


 
.great-vibes {
  font-family: "Great Vibes", cursive;
}
h1 {
  font-family: "Great Vibes", "Open Sans", sans-serif;
  font-size: 5.5rem;
}
.font-middle-earth-joanna-vu {
  font-family: "MiddleEarth JoannaVu", "Great Vibes", "Open Sans", sans-serif
}

 
 
.tikzjax {
  display: flex;
  justify-content: center;  
  align-items: center;      
}

 
details.table-of-contents-all-bold-but-summary > :not(summary) {
  font-weight: bold;
}


 
 
blockquote.alert-caution *:not(p:first-of-type) {
  color: red;
}
</style>










<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />







  <style>@font-face {
  font-family: 'Great Vibes';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url(https://fonts.gstatic.com/s/greatvibes/v21/RWmMoKWR9v4ksMfaWd_JN-XC.ttf) format('truetype');
}
</style>




<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true,
    packages: {'[+]': ['ams', 'boldsymbol']}  
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    ignoreHtmlClass: 'tex2jax_ignore|tikz-container'
  },
  loader: {
    load: ['[tex]/ams', '[tex]/boldsymbol']
  },
  startup: {
    ready() {
      console.log('MathJax is initializing...');
      MathJax.startup.defaultReady();
      MathJax.startup.promise.then(() => {
        console.log('MathJax typesetting complete');
      }).catch((err) => {
        console.error('MathJax failed:', err);
      });
    }
  }
};
</script>

<script src="https://cdn.jsdelivr.net/npm/core-js-bundle@3/minified.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.js"></script>



<link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
<script src="https://tikzjax.com/v1/tikzjax.js"></script>



<script src="/js/tikzjax-node.min.679617c0048325b476a16f95d017ba0858e995ffdc938c4fa7f8b994e1e9d2a0.js" integrity="sha256-Z5YXwASDJbR2oW&#43;V0Be6CFjplf/ck4xPp/i5lOHp0qA=" defer></script>




<link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css"/>
</head>
  <body>
  <main class="content page-template page-">
    <article class="post page">
      <header class="post-header">
        
          
        <a id="back-to-main-page" href="/"><i class="fa fa-chevron-left" aria-hidden="true"></i> J. Marinero - Data Scientist &amp; AI Engineer</a>
          
        
      </header>
      <h1 class="post-title">Custom Hugo shortcode to render tables with images</h1>
      <section class="post-content">
        <p>In previous post we studied basic scenarios to apply:</p>
<ul>
<li><a href="/blogs/hugo_shortcodes/"><strong>Hugo shortcodes</strong></a></li>
<li><a href="/blogs/hugo_render_hooks/"><strong>Hugo render hooks</strong></a></li>
<li><a href="/blogs/hugo_page_bundles/"><strong>Hugo page bundles</strong></a></li>
</ul>
<p>With all these knowledge we are ready to create, step by step, a custom <strong>Hugo shortcode</strong> that renders a <strong>CSV</strong> into a <strong>table</strong> displaying even an <strong>image</strong> column.</p>
<p>A picture is worth a thousand words. We will create this cheatsheet for Age of Empires II (complete table <a href="/aoe2_cheatsheet/#tldr">here</a>).</p>


<div style="height: 50vh; overflow: hidden;">
  <img src="/images/blogs/hugo_shortcode_CSV_to_table/06_filter__structures.png"
    alt="06_filter__structures.png" style="clip-path: inset(0 0 50% 0);">
</div>


<p>In the process we will cover:</p>
<ul>
<li>How to integrate data repositories in our Hugo project via Git submodules</li>
<li>Generate dataset structures applying basic data preprocessing algorithms (import, filter, join,&hellip;) and tools
(<code>jq</code>, <code>sed</code>, <code>awk</code>, <code>pandas</code>,&hellip;).</li>
</ul>
<p>Normally one picks a code and sticks to it, for example Python via Jupyter Notebooks or R via RStudio.</p>
<p>But our <strong>data mining</strong> task is somehow <strong>simple</strong> enough to be accomplished with short shell and Python scripts
while taking advantage of the power of Hugo shortcode template that we will code to render CSV tables and the images referenced in it.</p>

<details>
  <summary><strong>Index</strong> - Click to expand ðŸ“œ</summary>
  <ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#hugo-layout-for-jumbo-landscape-elements">Hugo layout for jumbo landscape elements</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#minimal-layout">Minimal layout</a></li>
</ul>
</li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#shortcodes">Shortcodes</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#get-local-resources">Get local resources</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#minimal-table">Minimal table</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#table-that-renders-images">Table that renders images</a></li>
</ul>
</li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#data">Data</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#age-of-empires-ii-api">age-of-empires-II-api</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#not-an-api-anymore">Not an API anymore</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#age-of-empires-II-api--git-submodule-and-sparse-checkout">Git submodule and sparse checkout</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#directory-in-the-hugo-project">Directory in the Hugo project</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#add-the-git-submodule-and-create-the-sparse-checkout">Add the git submodule and create the sparse checkout</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#update-the-spared-git-submodule">Update the spared git submodule</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#aoe2techtree">aoe2techtree</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#aoe2techtree--git-submodule-and-sparse-checkout">Git submodule and sparse checkout</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#aoe2techtree-json-file">aoe2techtree JSON file</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#aoe2techtree-images">aoe2techtree images</a></li>
</ul>
</li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#study-the-structured-data">Study the structured data</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#vim">Vim</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#the-jq-command">The jq command</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#merge-the-structured-data">Merge the structured data</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#add-an-id-field-to-age-of-empires-ii-api">Add an ID field to age-of-empires-II-api</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#get-the-unique-names">Get the unique names</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#simplify-the-aoe2techtree-data">Simplify the aoe2techtree data</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#get-the-language-names">Get the language names</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#linked-data-between-api-s">Linked data between API-s</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#merge-the-icons">Merge the icons</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#manual-matches">Manual matches</a></li>
</ul>
</li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#hotkeys">Hotkeys</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#create-a-hotkey-table">Create a hotkey table</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#merge">Merge</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#add-the-aoe2api-fields">Add the AOE2API fields</a></li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#final-result">Final result</a></li>
</ul>
</li>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#bonus">Bonus</a>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#imagination-is-the-limit">Imagination is the limit</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</details>



<div class="html-content">
<br>
</div>


<h2 id="hugo-layout-for-jumbo-landscape-elements">Hugo layout for jumbo landscape elements</h2>
<p>The tables to be rendered might expand horizontally much more than what would fit in a single page theme layout.</p>
<p>In my post concerning <a href="/blogs/hugo_page_bundles/">Hugo bundle pages</a>
we learned how to create a layout for a bundle page.
Read <a href="/blogs/hugo_page_bundles/#custom-layouts-for-a-leaf-bundle">Custom layouts for a leaf bundle</a>.
Following the same pattern applies.</p>
<h3 id="minimal-layout">Minimal layout</h3>
<p>We create a very basic template in <code>layouts/minimal/single.html</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Copy single.html</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">newLayout</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;layouts/minimal/single.html&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#719e07">$(</span>dirname <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$newLayout</span><span style="color:#2aa198">&#34;</span><span style="color:#719e07">)</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>cp -v _vendor/github.com/zjedi/hugo-scroll/layouts/_default/single.html <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$newLayout</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Edit width</span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># sed -i &#39;s/&lt;article class=&#34;post page&#34;&gt;/&lt;article class=&#34;page&#34;&gt;/g&#39; &#34;$newLayout&#34;</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#2aa198">&#39;s|&lt;article class=&#34;post page&#34;&gt;|&lt;article class=&#34;post page&#34; style=&#34;width: 99%; max-width: 100%;&#34;&gt;|g&#39;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$newLayout</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>In <code>&lt;article&gt;</code> we can remove the <code>post</code> in <code>class</code>-es (commented code line),
which is defined in Hugo Scroll theme <a href="https://github.com/zjedi/hugo-scroll/blob/master/assets/css/theme.scss#L233"><code>assets/css/theme.scss</code></a>,
because we want to use full width tables, not <code>width: 80%; max-width: 700px;</code>.
Instead, last code line applied the CSS herarchy, an inline <code>style</code> in <code>&lt;article&gt;</code>.</p>
<p>Also add a <a href="https://gohugo.io/methods/page/tableofcontents/"><code>{{ .TableOfContents }}</code></a> inbetween <code>&lt;h1&gt;</code> and <code>{{ .Content }}</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sed -i <span style="color:#2aa198">&#39;/&lt;h1 class=&#34;post-title&#34;&gt;{{ .Title }}&lt;\/h1&gt;/a\
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">      &lt;p&gt;Index&lt;/p&gt;\
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">      {{ .TableOfContents }}&#39;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$newLayout</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Create a leaf page to test the new layout.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># content/en/ not needed</span>
</span></span><span style="display:flex;"><span>hugo new aoe2_cheatsheet/index.md
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Open</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">$EDITOR</span> content/en/aoe2_cheatsheet/index.md
</span></span></code></pre></div><p>Edit front matter and content:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>---
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>title: &#39;AOE2 Cheatsheet&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>type: &#34;minimal&#34;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>---</span></span></code></pre></div>
<p>Test the <code>minimal</code> layout with a wide table like next.</p>
<table>
  <thead>
      <tr>
          <th>Name</th>
          <th style="text-align: center">Age</th>
          <th style="text-align: right">Score</th>
          <th>Country</th>
          <th>City</th>
          <th>Nationality</th>
          <th>University</th>
          <th>Experience (years)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Maria</td>
          <td style="text-align: center">30</td>
          <td style="text-align: right">95</td>
          <td>Spain</td>
          <td>Madrid</td>
          <td>Spanish</td>
          <td>UNED</td>
          <td>3</td>
      </tr>
      <tr>
          <td>Daniel</td>
          <td style="text-align: center">25</td>
          <td style="text-align: right">87</td>
          <td>Germany</td>
          <td>Berlin</td>
          <td>German</td>
          <td>Hochschule Muenchen</td>
          <td>2.5</td>
      </tr>
  </tbody>
</table>
<p>See it <a href="/aoe2_cheatsheet/#test-the-minimal-layout">here</a>.</p>
<p>The table is rendered as expected.</p>
<p>Note, a single page, instead of <code>index.md</code>, would be valid for this test.</p>
<h2 id="shortcodes">Shortcodes</h2>
<p>Lets create a Hugo shortcode that prints the local resources content of type CSV.
The template must eventually render a column as <code>&lt;img&gt;</code> too.</p>
<p>To achieve this we will progress little by little.</p>
<h3 id="get-local-resources">Get local resources</h3>
<p>Code <code>layouts/shortcodes/getresource-test-01.html</code> to print local resources content.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>{{ $path <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;path&#34;</span> }}
</span></span><span style="display:flex;"><span>{{ $resource <span style="color:#719e07">:=</span> .Page.Resources.GetMatch $path }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#719e07">if</span> $resource }}
</span></span><span style="display:flex;"><span>  &lt;div class=<span style="color:#2aa198">&#34;resource-content&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;h4&gt;Resource: {{ $resource.Name }}&lt;<span style="color:#719e07">/</span>h4&gt;
</span></span><span style="display:flex;"><span>    {{ <span style="color:#719e07">if</span> eq $resource.MediaType.SubType <span style="color:#2aa198">&#34;csv&#34;</span> }}
</span></span><span style="display:flex;"><span>      &lt;pre&gt;{{ $resource.Content }}&lt;<span style="color:#719e07">/</span>pre&gt;
</span></span><span style="display:flex;"><span>    {{ <span style="color:#719e07">else</span> <span style="color:#719e07">if</span> eq $resource.MediaType.SubType <span style="color:#2aa198">&#34;svg&#34;</span> }}
</span></span><span style="display:flex;"><span>      &lt;div class=<span style="color:#2aa198">&#34;svg-container&#34;</span>&gt;{{ $resource.Content | safeHTML }}&lt;<span style="color:#719e07">/</span>div&gt;
</span></span><span style="display:flex;"><span>    {{ <span style="color:#719e07">else</span> <span style="color:#719e07">if</span> eq $resource.MediaType.Type <span style="color:#2aa198">&#34;image&#34;</span> }}
</span></span><span style="display:flex;"><span>      &lt;img src=<span style="color:#2aa198">&#34;{{ $resource.RelPermalink }}&#34;</span> alt=<span style="color:#2aa198">&#34;{{ $resource.Name }}&#34;</span> loading=<span style="color:#2aa198">&#34;lazy&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    {{ <span style="color:#719e07">else</span> }}
</span></span><span style="display:flex;"><span>      &lt;pre&gt;{{ $resource.Content }}&lt;<span style="color:#719e07">/</span>pre&gt;
</span></span><span style="display:flex;"><span>    {{ end }}
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#719e07">/</span>div&gt;
</span></span><span style="display:flex;"><span>{{ <span style="color:#719e07">else</span> }}
</span></span><span style="display:flex;"><span>  &lt;div class=<span style="color:#2aa198">&#34;error&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;Resource not found in page bundle: {{ $path }}&lt;<span style="color:#719e07">/</span>p&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;Current page directory: {{ .Page.File.Dir }}&lt;<span style="color:#719e07">/</span>p&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;Available resources in this bundle:&lt;<span style="color:#719e07">/</span>p&gt;
</span></span><span style="display:flex;"><span>    &lt;ul&gt;
</span></span><span style="display:flex;"><span>      {{ <span style="color:#719e07">range</span> .Page.Resources }}
</span></span><span style="display:flex;"><span>        &lt;li&gt;{{ .Name }} ({{ .MediaType }})&lt;<span style="color:#719e07">/</span>li&gt;
</span></span><span style="display:flex;"><span>      {{ <span style="color:#719e07">else</span> }}
</span></span><span style="display:flex;"><span>        &lt;li&gt;No resources found in this page bundle&lt;<span style="color:#719e07">/</span>li&gt;
</span></span><span style="display:flex;"><span>      {{ end }}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#719e07">/</span>ul&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#719e07">/</span>div&gt;
</span></span><span style="display:flex;"><span>{{ end }}
</span></span></code></pre></div><p>Get a sample CSV</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">dataDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data/sample&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$dataDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>curl -o <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$dataDir</span><span style="color:#2aa198">/iris.csv&#34;</span> https://www.timestored.com/data/sample/iris.csv
</span></span></code></pre></div><p>Append next to <code>content/en/new aoe2_cheatsheet/index.md</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">getresource-test-01</span> path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/sample/iris.csv&#34;</span> &gt;}}
</span></span></code></pre></div><p>See it <a href="/aoe2_cheatsheet/#the-getresource-shortcode">here</a>.
The content of this CSV is raw displayed.</p>
<p>Note. A single page would <strong>not</strong> work because the shortcode reads resources in our local bundle,
not in a global resource path like <code>data/</code> or <code>assests/</code>.</p>
<p>The error message list the available resources in the bundle.
Test it with:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">getresource-test-01</span> path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;test-missing-file.csv&#34;</span> &gt;}}
</span></span></code></pre></div><p>See it <a href="/aoe2_cheatsheet/#the-getresource-shortcode-error">here</a>.</p>
<p>It renders</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Resource not found in page bundle: test-missing-file.csv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Current page directory: aoe2_cheatsheet/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Available resources in this bundle:
</span></span><span style="display:flex;"><span>  - data/sample/iris.csv (text/csv)
</span></span><span style="display:flex;"><span>  - [...]
</span></span></code></pre></div><h3 id="minimal-table">Minimal table</h3>
<p>We need to create a shortcode that accepts a CSV file-path as parameter.</p>
<p>Next is a good starting point.
Book <a href="https://hugo-in-action.foofun.cn/">Hugo in Action</a>,
<a href="https://hugo-in-action.foofun.cn/docs/part1/chapter5/3/#532-parsing-files-for-data">Parsing files for data</a>:</p>



  <blockquote>
    <p>We need to render this [<code>products.csv</code>] as a table in the <strong>home page</strong> of the website.
We can place products.csv in the root of the <code>content</code> folder to make it a part of the <em>branch bundle</em> for the index page.</p>
  </blockquote>

<p>We create <code>layouts/shortcodes/csv-to-table.html</code>, to render a <strong>bundle</strong> resource CSV,
copying <a href="https://gitlab.nccr-automation.ch/docs/hugo-docsy/-/blob/main/layouts/shortcodes/csv-to-table.html">this</a> template.
Courtesy of <a href="https://gitlab.nccr-automation.ch/docs/hugo-docsy">https://gitlab.nccr-automation.ch/docs/hugo-docsy</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">template</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;layouts/shortcodes/csv-to-table.html&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">URL</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;https://gitlab.nccr-automation.ch/docs/hugo-docsy/-/raw/main/layouts/shortcodes/csv-to-table.html&#34;</span>
</span></span><span style="display:flex;"><span>wget -O <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">template</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">URL</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Add to <code>index.md</code> next shortcode call. In later sections it&rsquo;s explained how to generate that CSV file.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">csv-to-table</span> path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/sample/iris.csv&#34;</span> &gt;}}
</span></span></code></pre></div><p>See it <a href="/aoe2_cheatsheet/#the-csv-to-table-shortcode">here</a>.</p>
<h3 id="table-that-renders-images">Table that renders images</h3>
<p>Copy the previous template and extend it.</p>
<p><code>layouts/shortcodes/csv-to-table-imgs.html</code> must be coded to:</p>
<ul>
<li>Accept <code>img_path</code>, <code>img_field</code>, <code>img_format</code> and <code>img_field_raw</code> parameters.</li>
<li>Render a <strong>project</strong> resources images.</li>
</ul>
<p>Debugging it&rsquo;s useful to display both the rendered image and the column that specifies it.</p>
<ul>
<li>When <code>img_field_raw=&quot;false&quot;</code>: show only the rendered image column (without the original <code>img_field</code> column)</li>
<li>When <code>img_field_raw=&quot;true&quot;</code> (default): show both</li>
</ul>

<details>
  <summary><code>csv-to-table-imgs.html</code> - Click to expand ðŸ“œ</summary>
  <div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> <span style="color:#586e75">/* csv-to-table-imgs.html */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Converts a CSV file to an HTML table with images */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $path <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;path&#34;</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $img_path <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;img_path&#34;</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $img_field <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;img_field&#34;</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $img_format <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;img_format&#34;</span> | <span style="color:#719e07">default</span> <span style="color:#2aa198">&#34;png&#34;</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $img_field_raw <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;img_field_raw&#34;</span> | <span style="color:#719e07">default</span> <span style="color:#2aa198">&#34;true&#34;</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $caption <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;caption&#34;</span> | <span style="color:#719e07">default</span> <span style="color:#2aa198">&#34;&#34;</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $class <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;class&#34;</span> | <span style="color:#719e07">default</span> <span style="color:#2aa198">&#34;&#34;</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $delimiter <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;delimiter&#34;</span> | <span style="color:#719e07">default</span> <span style="color:#2aa198">&#34;,&#34;</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $hasHeaderRow <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;hasHeaderRow&#34;</span> | <span style="color:#719e07">default</span> <span style="color:#cb4b16">true</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $id <span style="color:#719e07">:=</span> .Get <span style="color:#2aa198">&#34;id&#34;</span> | <span style="color:#719e07">default</span> (printf <span style="color:#2aa198">&#34;csv-table-%d&#34;</span> .Ordinal) <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Get the CSV resource from the page bundle */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> $resource <span style="color:#719e07">:=</span> .Page.Resources.GetMatch $path <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> not $resource <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  &lt;div class=<span style="color:#2aa198">&#34;error&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;CSV resource not found: {{ $path }}&lt;<span style="color:#719e07">/</span>p&gt;
</span></span><span style="display:flex;"><span>    &lt;p&gt;Available resources in this bundle:&lt;<span style="color:#719e07">/</span>p&gt;
</span></span><span style="display:flex;"><span>    &lt;ul&gt;
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> <span style="color:#719e07">range</span> .Page.Resources <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        &lt;li&gt;{{ .Name }} ({{ .MediaType }})&lt;<span style="color:#719e07">/</span>li&gt;
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> <span style="color:#719e07">else</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        &lt;li&gt;No resources found in this page bundle&lt;<span style="color:#719e07">/</span>li&gt;
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#719e07">/</span>ul&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#719e07">/</span>div&gt;
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> <span style="color:#719e07">else</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Parse the CSV content */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#719e07">-</span> $csvData <span style="color:#719e07">:=</span> $resource.Content | transform.<span style="color:#268bd2">Unmarshal</span> (dict <span style="color:#2aa198">&#34;delimiter&#34;</span> $delimiter) <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Find the image column index if img_field is specified */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#719e07">-</span> $imgColIndex <span style="color:#719e07">:=</span> <span style="color:#719e07">-</span><span style="color:#2aa198">1</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> and $img_field $hasHeaderRow <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>    {{<span style="color:#719e07">-</span> $headerRow <span style="color:#719e07">:=</span> index $csvData <span style="color:#2aa198">0</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>    {{<span style="color:#719e07">-</span> <span style="color:#719e07">range</span> $index, $value <span style="color:#719e07">:=</span> $headerRow <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> eq $value $img_field <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> $imgColIndex = $index <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>    {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Create the table */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  &lt;table {{ with $id }}id=<span style="color:#2aa198">&#34;{{ . }}&#34;</span>{{ end }} {{ with $class }}class=<span style="color:#2aa198">&#34;{{ . }}&#34;</span>{{ end }}&gt;
</span></span><span style="display:flex;"><span>    {{<span style="color:#719e07">-</span> with $caption <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      &lt;caption&gt;{{ . }}&lt;<span style="color:#719e07">/</span>caption&gt;
</span></span><span style="display:flex;"><span>    {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> $hasHeaderRow <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> $headerRow <span style="color:#719e07">:=</span> index $csvData <span style="color:#2aa198">0</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Remove the img_field from header if img_field_raw is false */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> <span style="color:#268bd2">and</span> (eq $img_field_raw <span style="color:#2aa198">&#34;false&#34;</span>) $<span style="color:#268bd2">img_field</span> (ne $imgColIndex <span style="color:#719e07">-</span><span style="color:#2aa198">1</span>) <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> $newHeaderRow <span style="color:#719e07">:=</span> slice <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> <span style="color:#719e07">range</span> $index, $value <span style="color:#719e07">:=</span> $headerRow <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>          {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> ne $index $imgColIndex <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> $newHeaderRow = $newHeaderRow | append $value <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>          {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> $headerRow = $newHeaderRow <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> $rows <span style="color:#719e07">:=</span> after <span style="color:#2aa198">1</span> $csvData <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Add image column to header */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> $img_field <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> $headerRow = (<span style="color:#268bd2">slice</span> (printf <span style="color:#2aa198">&#34;%s-img-rendered&#34;</span> $img_field)) | append $headerRow <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      &lt;thead&gt;
</span></span><span style="display:flex;"><span>        &lt;tr&gt;
</span></span><span style="display:flex;"><span>          {{<span style="color:#719e07">-</span> <span style="color:#719e07">range</span> $headerRow <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            &lt;th&gt;{{ . | markdownify }}&lt;<span style="color:#719e07">/</span>th&gt;
</span></span><span style="display:flex;"><span>          {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#719e07">/</span>tr&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#719e07">/</span>thead&gt;
</span></span><span style="display:flex;"><span>      &lt;tbody&gt;
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> <span style="color:#719e07">range</span> $rows <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>          &lt;tr&gt;
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Add image column first */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> and $<span style="color:#268bd2">img_field</span> (ne $imgColIndex <span style="color:#719e07">-</span><span style="color:#2aa198">1</span>) <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>              &lt;td&gt;
</span></span><span style="display:flex;"><span>                {{<span style="color:#719e07">-</span> $imgName <span style="color:#719e07">:=</span> index . $imgColIndex <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                {{<span style="color:#719e07">-</span> $imgSrc <span style="color:#719e07">:=</span> printf <span style="color:#2aa198">&#34;%s/%s.%s&#34;</span> (strings.TrimSuffix <span style="color:#2aa198">&#34;/&#34;</span> $img_path) $imgName $img_format <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                &lt;img src=<span style="color:#2aa198">&#34;{{ $imgSrc }}&#34;</span> alt=<span style="color:#2aa198">&#34;{{ $imgName }}&#34;</span> loading=<span style="color:#2aa198">&#34;lazy&#34;</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#719e07">/</span>td&gt;
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Add all other columns */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> <span style="color:#719e07">range</span> $index, $value <span style="color:#719e07">:=</span> . <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>              {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> <span style="color:#268bd2">or</span> (eq $img_field_raw <span style="color:#2aa198">&#34;true&#34;</span>) (ne $index $imgColIndex) <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                &lt;td&gt;
</span></span><span style="display:flex;"><span>                  {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> <span style="color:#268bd2">and</span> (eq $index $imgColIndex) $img_path <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                    {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Show the original value */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                    {{<span style="color:#719e07">-</span> $value | markdownify <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                  {{<span style="color:#719e07">-</span> <span style="color:#719e07">else</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                    {{<span style="color:#719e07">-</span> $value | markdownify <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                  {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#719e07">/</span>td&gt;
</span></span><span style="display:flex;"><span>              {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#719e07">/</span>tr&gt;
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#719e07">/</span>tbody&gt;
</span></span><span style="display:flex;"><span>    {{<span style="color:#719e07">-</span> <span style="color:#719e07">else</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      &lt;tbody&gt;
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> <span style="color:#719e07">range</span> $csvData <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>          &lt;tr&gt;
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Add image column first if img_field is specified */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> <span style="color:#719e07">if</span> and $<span style="color:#268bd2">img_field</span> (ne $imgColIndex <span style="color:#719e07">-</span><span style="color:#2aa198">1</span>) <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>              &lt;td&gt;
</span></span><span style="display:flex;"><span>                {{<span style="color:#719e07">-</span> $imgName <span style="color:#719e07">:=</span> index . $imgColIndex <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                {{<span style="color:#719e07">-</span> $imgSrc <span style="color:#719e07">:=</span> printf <span style="color:#2aa198">&#34;%s/%s.%s&#34;</span> (strings.TrimSuffix <span style="color:#2aa198">&#34;/&#34;</span> $img_path) $imgName $img_format <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>                &lt;img src=<span style="color:#2aa198">&#34;{{ $imgSrc }}&#34;</span> alt=<span style="color:#2aa198">&#34;{{ $imgName }}&#34;</span> loading=<span style="color:#2aa198">&#34;lazy&#34;</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#719e07">/</span>td&gt;
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> <span style="color:#586e75">/* Add all other columns */</span> <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> <span style="color:#719e07">range</span> . <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>              &lt;td&gt;{{ . | markdownify }}&lt;<span style="color:#719e07">/</span>td&gt;
</span></span><span style="display:flex;"><span>            {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#719e07">/</span>tr&gt;
</span></span><span style="display:flex;"><span>        {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#719e07">/</span>tbody&gt;
</span></span><span style="display:flex;"><span>    {{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#719e07">/</span>table&gt;
</span></span><span style="display:flex;"><span>{{<span style="color:#719e07">-</span> end <span style="color:#719e07">-</span>}}
</span></span></code></pre></div></details>

<p>We can call it with next CSV and image path, but we will explain in next sections how to get them.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>Show both the rendered img and its field value.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">csv-to-table-imgs</span>
</span></span><span style="display:flex;"><span>  path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2techtree/02_add_languages_names/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span>  img_path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/images/aoe2techtree/img/Buildings&#34;</span>
</span></span><span style="display:flex;"><span>  img_field<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>&gt;}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The rendered img only. I.e. field <span style="color:#586e75">`id`</span> is not displayed.
</span></span><span style="display:flex;"><span>Note: some images not rendered because they lack in the [<span style="color:#268bd2">`aoe2techtree/img/Units`</span>](https://github.com/SiegeEngineers/aoe2techtree/tree/master/img/Units) folder of the repo.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">csv-to-table-imgs</span>
</span></span><span style="display:flex;"><span>  path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2techtree/02_add_languages_names/units.csv&#34;</span>
</span></span><span style="display:flex;"><span>  img_path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/images/aoe2techtree/img/Units&#34;</span>
</span></span><span style="display:flex;"><span>  img_field<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>  img_field_raw<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>&gt;}}
</span></span></code></pre></div><p>See it <a href="/aoe2_cheatsheet/#the-csv-to-table-imgs-shortcode">here</a>.</p>
<h2 id="data">Data</h2>
<h3 id="age-of-empires-ii-api">age-of-empires-II-api</h3>
<h4 id="not-an-api-anymore">Not an API anymore</h4>
<p>In the <a href="https://github.com/aalises/age-of-empires-II-api">age-of-empires-II-api</a> repo we have
the structure file <a href="https://github.com/aalises/age-of-empires-II-api/blob/master/data/structures.csv"><code>structures.csv</code></a>.
The header (fields) and first three records (rows) are:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csv" data-lang="csv"><span style="display:flex;"><span><span style="color:#2aa198">name</span>,<span style="color:#2aa198"> expansion</span>,<span style="color:#2aa198"> age</span>,<span style="color:#2aa198"> cost</span>,<span style="color:#2aa198"> build_time</span>,<span style="color:#2aa198"> hit_points</span>,<span style="color:#2aa198"> line_of_sight</span>,<span style="color:#2aa198"> armor</span>,<span style="color:#2aa198"> range</span>,<span style="color:#2aa198"> reload_time</span>,<span style="color:#2aa198"> attack</span>,<span style="color:#2aa198"> special</span>
</span></span><span style="display:flex;"><span><span style="color:#2aa198">Barracks</span>,<span style="color:#2aa198"> Age of Kings</span>,<span style="color:#2aa198"> Dark</span>,<span style="color:#2aa198"> {&#34;Wood&#34;: 175}</span>,<span style="color:#2aa198"> 50</span>,<span style="color:#2aa198"> 1200</span>,<span style="color:#2aa198">5</span>,<span style="color:#2aa198">0/7</span>,,,,<span style="color:#2aa198">Garrison: 10 created units</span>
</span></span><span style="display:flex;"><span><span style="color:#2aa198">Dock</span>,<span style="color:#2aa198"> Age of Kings</span>,<span style="color:#2aa198"> Dark</span>,<span style="color:#2aa198"> {&#34;Wood&#34;: 150}</span>,<span style="color:#2aa198"> 35</span>,<span style="color:#2aa198"> 1800</span>,<span style="color:#2aa198">5</span>,<span style="color:#2aa198">0/7</span>,,,,<span style="color:#2aa198">Garrison: 10 created units</span>
</span></span><span style="display:flex;"><span><span style="color:#2aa198">Farm</span>,<span style="color:#2aa198"> Age of Kings</span>,<span style="color:#2aa198"> Dark</span>,<span style="color:#2aa198"> {&#34;Wood&#34;: 60}</span>,<span style="color:#2aa198">15</span>,<span style="color:#2aa198"> 480</span>,<span style="color:#2aa198">0</span>,<span style="color:#2aa198"> 0/0</span>,,,,<span style="color:#2aa198">Standard = 175 Food;Horse Collar = 250 Food;Heavy Plow = 375 Food;Crop Rotation = 550 Food</span>
</span></span></code></pre></div><p>Great! We don&rsquo;t have to manually populate it. It&rsquo;s already done.</p>
<p>We would like to create API calls to get the data from the <a href="https://github.com/aalises/age-of-empires-II-api">age-of-empires-II-api</a> API.</p>
<p>But, as specified in its <a href="https://github.com/aalises/age-of-empires-II-api#disclaimer">disclaimer</a>, the API is down.</p>
<p>This is inconvenient, but not a tragedy, we just need to get the
<a href="https://github.com/aalises/age-of-empires-II-api/tree/master/data"><code>age-of-empires-II-api/data/</code></a>
folder.</p>


<!--
   - It's a LOCAL API, not a public one.
   - Thus, links like next explain an API URL that returns 404:
   - - Basic usage: https://publicapis.io/age-of-empires-ii-api
   - - Postman: https://documenter.getpostman.com/view/78530/RztoM8AL
   - - API tutorial https://www.genspark.ai/spark/age-of-empires-2-api-options/5cde7e12-e164-4ab0-9ed0-6790d30b2686
   -->


<h4 id="age-of-empires-II-api--git-submodule-and-sparse-checkout">Git submodule and sparse checkout</h4>
<h5 id="directory-in-the-hugo-project">Directory in the Hugo project</h5>
<p>The documentation defines the <a href="https://gohugo.io/content-management/data-sources/">Data sources</a> as:</p>



  <blockquote>
    <p>A data source might be a file in the <code>data</code> directory, a global resource, a page resource, or a remote resource.</p>
  </blockquote>

<p>From the ebook <a href="https://hugo-in-action.foofun.cn/">Hugo in Action</a>,
<a href="https://hugo-in-action.foofun.cn/docs/part1/chapter2/1/#213-structure-of-the-hugo-source-folder">Structure of the Hugo source folder</a>, the <em>data/</em> folder purpose:</p>



  <blockquote>
    <p>dataâ€”Stores structured content in the form of YAML, TOML, CSV, or JSON files, which are made available as global variables throughout the website.
A traditional database houses more than just web page content.
There can be tables associated with structured data, which have no place in the content folder,
so this folder comes in handy when we generate content from outside of Hugo and pass that information in as a JSON or a CSV file for Hugo to consume.
We will read from the data folder in chapter 5.</p>
  </blockquote>

<p>And the <em>api</em> directory:</p>



  <blockquote>
    <p><code>api</code> folderâ€”Although not standard, weâ€™ll create this folder to house custom APIs in chapter 11.</p>
  </blockquote>

<p>From the ebook <a href="https://hugo-in-action.foofun.cn/">Hugo in Action</a>,
<a href="https://hugo-in-action.foofun.cn/docs/part1/chapter4/3/#431-leaf-bundles">Better together with page bundles</a>:</p>



  <blockquote>
    <p>The About page in the Acme Corporation website is the perfect page to turn into a <strong>leaf bundle</strong>.
The draw.jpg image is <strong>used in the page, not anywhere else</strong>, and we should <strong>localize it to that page</strong>.</p>
  </blockquote>

<p>So, where to locate the CSV files?</p>
<ul>
<li>These local CSV files are, as said, local, they are not obtained via an API call using a Javascript file.
Thus we discard the <code>api/</code> folder to locate them.</li>
<li>If they are meant to be used in the AOE2 cheatsheet page and nowhere else,
then these structured content files location shuld be in the leaf bundle folder <code>content/en/aoe2_cheatsheet/</code>.</li>
<li>But I think that this data will be handy for future posts, I need them to be availables as global variable in <code>data/</code>.</li>
</ul>
<h5 id="add-the-git-submodule-and-create-the-sparse-checkout">Add the git submodule and create the sparse checkout</h5>
<p>Since our Hugo project is a git repository,
we can use the <code>git submodule</code> command to <strong>add the submodule directory <code>data/age-of-empires-II-api/</code></strong> to our main project repository.</p>
<p>But we don&rsquo;t need the whole <a href="https://github.com/aalises/age-of-empires-II-api">age-of-empires-II-api</a> repository.</p>
<p>When working with large repositories, one might only need specific directories.
<a href="https://git-scm.com/docs/git-sparse-checkout">Git&rsquo;s sparse checkout</a> command can</p>



  <blockquote>
    <p>change the working tree from having all tracked files present to only having a subset of those files.</p>
  </blockquote>

<p>We can use this feature to <strong>keep only the <a href="https://github.com/aalises/age-of-empires-II-api/tree/master/data">age-of-empires-II-api/data/</a> dir</strong>ectory
and not the whole <a href="https://github.com/aalises/age-of-empires-II-api">age-of-empires-II-api</a> repository.</p>
<p>So, lets dive in!</p>
<p>First. Navigate to the main project root.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt; <span style="color:#586e75"># edit!</span>
</span></span></code></pre></div><p>In following commands do not confuse:</p>
<ul>
<li>The <code>data/</code> in our local Hugo project.</li>
<li>The <code>data/</code> in the repo <a href="https://github.com/aalises/age-of-empires-II-api/blob/master/data/">age-of-empires-II-api</a>
that we aim to clone into <code>data/age-of-empires-II-api/data</code> of our Hugo project.</li>
</ul>
<p>Add the git submodule, create the sparse checkout regexp and enable sparse checkout.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Add the whole repository as a git submodule into our data/ folder</span>
</span></span><span style="display:flex;"><span>git submodule add https://github.com/aalises/age-of-empires-II-api/ data/age-of-empires-II-api
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Create the info directory and sparse-checkout file for the submodule</span>
</span></span><span style="display:flex;"><span>mkdir -p .git/modules/data/age-of-empires-II-api/info
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Sparse-checkout regexp filters the tracked submodule content</span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># In this case limiting the track to the age-of-empires-II-api/data/ directory only</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">echo</span> <span style="color:#2aa198">&#34;data/*&#34;</span> &gt; .git/modules/data/age-of-empires-II-api/info/sparse-checkout
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Enable sparse checkout for the submodule</span>
</span></span><span style="display:flex;"><span>git -C .git/modules/data/age-of-empires-II-api/ config core.sparseCheckout <span style="color:#b58900">true</span>
</span></span></code></pre></div><p>Now force the submodule to reset with the <strong>new sparse checkout rules</strong>.</p>
<ul>
<li>Option A. Either from the submodule directory</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># First, navigate into the submodule directory</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> data/age-of-empires-II-api
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Reset the working tree to apply sparse checkout</span>
</span></span><span style="display:flex;"><span>git read-tree -mu HEAD
</span></span></code></pre></div><ul>
<li>Option B. Or from the main project directory</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git submodule update --force --checkout data/age-of-empires-II-api
</span></span></code></pre></div><p>Let&rsquo;s inspect the results.
Change directory to the submodule (<code>cd data/age-of-empires-II-api</code>) and run <code>git status</code>.
It echoes:</p>
<pre tabindex="0"><code>On branch master
Your branch is up to date with &#39;origin/master&#39;.

You are in a sparse checkout with 12% of tracked files present.

nothing to commit, working tree clean
</code></pre><p><code>ls -la</code> list only the <code>data/</code> directory and the <code>.git</code> file.
Which confirms
what the <em>12% of tracked files present</em> message stated,
that <em>git sparse checkout</em> is working &ndash; Git is only tracking and showing the files in the <code>data</code> directory,
ignoring the other 88% of files in the API repository.</p>
<p>Our tree structure is (<code>tree -a data/</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>our-hugo-project/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ assets/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ content/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ data/
</span></span><span style="display:flex;"><span>â”‚   â””â”€â”€ age-of-empires-II-api/  # The submodule
</span></span><span style="display:flex;"><span>â”‚       â”œâ”€â”€ .git
</span></span><span style="display:flex;"><span>â”‚       â””â”€â”€ data/  # The sparse-checked-out directory
</span></span><span style="display:flex;"><span>â”‚           â”œâ”€â”€ civilizations.csv
</span></span><span style="display:flex;"><span>â”‚           â”œâ”€â”€ structures.csv
</span></span><span style="display:flex;"><span>â”‚           â”œâ”€â”€ technologies.csv
</span></span><span style="display:flex;"><span>â”‚           â””â”€â”€ units.csv
</span></span><span style="display:flex;"><span>â””â”€â”€ [...]
</span></span></code></pre></div><h5 id="update-the-spared-git-submodule">Update the spared git submodule</h5>
<p>In future, we will only update the sparse-checkout files (<code>data/*</code>).</p>
<p>One can achieve this:</p>
<ul>
<li>From the main project directory (A options)</li>
<li>Or from the submodule directory (B options)</li>
</ul>
<p>Via:</p>
<ul>
<li>Merge (A.a and B.a)</li>
<li>Rebase (A.b and B.b)</li>
<li>Or hard reset (B.c)</li>
</ul>
<p><strong>A</strong> options first step</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt; <span style="color:#586e75"># edit!</span>
</span></span></code></pre></div><p><strong>A.a</strong> final step</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git submodule update --remote --merge data/age-of-empires-II-api
</span></span></code></pre></div><p><strong>A.b</strong> final step</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git submodule update --remote --rebase data/age-of-empires-II-api
</span></span></code></pre></div><p><strong>B</strong> options first steps</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt; <span style="color:#586e75"># edit!</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> data/age-of-empires-II-api
</span></span><span style="display:flex;"><span>git fetch origin
</span></span></code></pre></div><p>For the <strong>B</strong> options final steps we need to specify the <code>origin</code> branch we want to merge/rebase/reset-to.
Here it&rsquo;s <code>origin/master</code>. Not <code>origin/main</code>.</p>
<p><strong>B.a</strong> final step</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git merge origin/master
</span></span></code></pre></div><p><strong>B.b</strong> final step</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git rebase origin/master
</span></span></code></pre></div><p><strong>B.c</strong> final step</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># âš ï¸ Warning: This will discard any local changes you&#39;ve made in the submodule.</span>
</span></span><span style="display:flex;"><span>git reset --hard origin/master
</span></span></code></pre></div><p>Finally, no matter which option we applied, let&rsquo;s find out if the submodule is up to date.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt; <span style="color:#586e75"># edit!</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> data/age-of-empires-II-api
</span></span><span style="display:flex;"><span>git status
</span></span></code></pre></div><h3 id="aoe2techtree">aoe2techtree</h3>
<p>We need now to focus on the icons that represent the structures (buildings) and units.</p>
<p>A rundementary approach would be:</p>
<ul>
<li>Download as many icons as possible, for example the <a href="https://aoezone.net/threads/aoe2-icons-images-full-pack.188812/">AoE2 Full Pack Icons</a>
or one by one from <a href="https://www.spriters-resource.com/pc_computer/ageofempiresii/">spriters-resource.com</a>.</li>
<li>Manually tag the required icons in a CSV/JSON file.
Each <em>unit</em> <code>key</code> (ID) borrowed from the field <code>name</code>
from the <a href="https://github.com/aalises/age-of-empires-II-api">age-of-empires-II-api</a>&rsquo;s
<a href="https://github.com/aalises/age-of-empires-II-api/blob/master/data/units.csv"><code>units.csv</code></a>, while the only <code>value</code> is the icon file-name (or file-path if grouped).
Analogous for the <em>structures</em>.</li>
<li>Finally upload both the icons files and the structured data file to our Hugo project.</li>
</ul>
<p>But we are lazy!
Why would we spend 15 minutes on a non-automated task
when we could automate the process with a script that would take much longer to write?</p>
<p><a href="https://programmerhumor.io/programming-memes/that-moment-2/"><img src="https://i.programmerhumor.io/2022/08/programmerhumor-io-programming-memes-48bdde77d47c8c0.jpg" alt="That moment. | IT-memes | ProgrammerHumor.io"></a></p>
<p>Civilization tree <a href="https://aoe2techtree.net/">https://aoe2techtree.net/</a> is generated thanks to the repository <a href="https://github.com/SiegeEngineers/aoe2techtree/">aoe2techtree</a>.</p>
<p>This projects shares:</p>
<ul>
<li>The PNG icons for the structures and units</li>
<li>A JSON that contains the data of the structures and units, including the mentioned icons</li>
</ul>
<h4 id="aoe2techtree--git-submodule-and-sparse-checkout">Git submodule and sparse checkout</h4>
<h5 id="aoe2techtree-json-file">aoe2techtree JSON file</h5>
<p>Add the git submodule, create the sparse checkout regexp and enable sparse checkout.</p>
<p>We would repeat the steps from previous section. So let&rsquo;s automate it.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#719e07">function</span> add_sparse_submodule<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">repositoryURL</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$1</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">submodule</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$2</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">shift</span> <span style="color:#2aa198">2</span>  <span style="color:#586e75"># Remove first two arguments, rest are patterns</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Add submodule</span>
</span></span><span style="display:flex;"><span>  git submodule add <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$repositoryURL</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$submodule</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Create sparse checkout config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">sparseCheckoutDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;.git/modules/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">submodule</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/info&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">sparseCheckoutFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">sparseCheckoutDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/sparse-checkout&#34;</span>
</span></span><span style="display:flex;"><span>  mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$sparseCheckoutDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Loop through remaining arguments (patterns)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">for</span> pattern in <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$@</span><span style="color:#2aa198">&#34;</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#b58900">echo</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$pattern</span><span style="color:#2aa198">&#34;</span> &gt;&gt; <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$sparseCheckoutFile</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">done</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Enable sparse checkout</span>
</span></span><span style="display:flex;"><span>  git -C <span style="color:#719e07">$(</span>dirname <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$sparseCheckoutDir</span><span style="color:#2aa198">&#34;</span><span style="color:#719e07">)</span> config core.sparseCheckout <span style="color:#b58900">true</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Apply sparse checkout</span>
</span></span><span style="display:flex;"><span>  git submodule update --force --checkout <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$submodule</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Check</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">cd</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$submodule</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  git status
</span></span><span style="display:flex;"><span>  tree -a .
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">cd</span> - &gt; /dev/null  <span style="color:#586e75"># Return to original directory</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></div><p>Call it</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to the main Hugo project directory</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt; <span style="color:#586e75"># edit!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Call</span>
</span></span><span style="display:flex;"><span>add_sparse_submodule <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;https://github.com/SiegeEngineers/aoe2techtree/&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;data/aoe2techtree&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;data/data.json&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;data/locales/en/strings.json&#34;</span>
</span></span></code></pre></div><p>It echoes the Git status</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>HEAD detached at b265c39
</span></span><span style="display:flex;"><span>You are in a sparse checkout with 1% of tracked files present.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nothing to commit, working tree clean
</span></span></code></pre></div><p>And the structure of files</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; tree -a data/aoe2techtree
</span></span><span style="display:flex;"><span>data/aoe2techtree
</span></span><span style="display:flex;"><span>â”œâ”€â”€ data
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ data.json
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ locales
</span></span><span style="display:flex;"><span>â”‚Â Â      â””â”€â”€ en
</span></span><span style="display:flex;"><span>â”‚Â Â          â””â”€â”€ strings.json
</span></span><span style="display:flex;"><span>â””â”€â”€ .git
</span></span></code></pre></div><h5 id="aoe2techtree-images">aoe2techtree images</h5>
<p>We could repeat previous steps with the images of the <em>aoe2techtree</em> repo, but now in the <code>assets/</code> directory.
<a href="https://hugo-in-action.foofun.cn/docs/part1/chapter2/1/#213-structure-of-the-hugo-source-folder">Structure of the Hugo source folder</a>
in the ebook <a href="https://hugo-in-action.foofun.cn/">Hugo in Action</a> states that:</p>
<p><code>assets</code> folderâ€”
Places <strong>images</strong>, JavaScript, and CSS files as <strong>unprocessed</strong> source code to be <strong>consumed globally</strong> from the website.
This folder allows us to <strong>process these files</strong> during compilation.
Hugo can resize images, bundle and minify JavaScript files, and convert SCSS to CSS via its asset pipeline (Hugo Pipes).</p>
<p>Hmmm&hellip;I think we don&rsquo;t want to process these icons at all. Maybe the <code>static/</code> folder? Since it&rsquo;s reserved for our <strong>static content</strong>.</p>
<p><code>static</code>â€”Stores static content like fonts or PDF files. Hugo <strong>copies this content as is to the output directory</strong>.</p>
<p>In summary,</p>
<ul>
<li><code>static/</code> for files served directly at site root (<code>yoursite.com/images/unit.png</code>)</li>
<li><code>assets/</code> if processed by Hugo (resizing, optimization, etc.)</li>
</ul>
<p>Another valid path is our <strong>local bundle</strong> (<code>content/en/aoe2_custom_cheatsheet/images</code>), if we don&rsquo;t aim to use them in other bundles (not to be <em>consumed globally</em>).</p>
<p>In these cases the sparse-checkout regular expression should filter <a href="https://github.com/SiegeEngineers/aoe2techtree/tree/master/img/Units"><code>img/Units/</code></a>
and <a href="https://github.com/SiegeEngineers/aoe2techtree/tree/master/img/Buildings"><code>img/Buildings/</code></a> only.
Well, the resource icons (food, stone,&hellip;) might be handy too.
&hellip;Actually the <code>img/</code> folder is about 2 MB, the project can handle it easily.</p>
<p>I choose global consumption in <code>static/images/</code>. Execute:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Call</span>
</span></span><span style="display:flex;"><span>add_sparse_submodule <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;https://github.com/SiegeEngineers/aoe2techtree/&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;static/images/aoe2techtree&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;img/Units/*.png&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;img/Buildings/*.png&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    <span style="color:#2aa198">&#34;img/*.png&#34;</span>
</span></span></code></pre></div><p>It prints:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Submodule path &#39;static/images/aoe2techtree&#39;: checked out &#39;b265c39ce331d354f5eeda3ffe2929925cd37bb1&#39;
</span></span><span style="display:flex;"><span>HEAD detached at b265c39
</span></span><span style="display:flex;"><span>You are in a sparse checkout with 40% of tracked files present.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nothing to commit, working tree clean
</span></span></code></pre></div><p>Let&rsquo;s check we can render images under <code>static</code>.</p>
<p><code>![Building-45](/images/aoe2techtree/img/Buildings/45.png)</code> shows:</p>
<img src="/images/aoe2techtree/img/Buildings/45.png" alt="Building-45"><h4 id="study-the-structured-data">Study the structured data</h4>
<h5 id="vim">Vim</h5>
<p>Open <code>data.json</code> with Vim or NeoVim</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>vim data/aoe2techtree/data/data.json
</span></span></code></pre></div><p>Set the foldmethod to <code>syntax</code> and enough fold-columns.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vim" data-lang="vim"><span style="display:flex;"><span>:<span style="color:#719e07">set</span> foldmethod=<span style="color:#719e07">syntax</span> foldcolumn=<span style="color:#2aa198">9</span>
</span></span></code></pre></div><p>That is:</p>
<ul>
<li>Press <code>Esc</code> to go to normal mode</li>
<li>Type the command above. You notice that once typed the first char (the <code>:</code> colon), a command bar appears, that&rsquo;s intended.</li>
<li>Press <code>Enter</code></li>
<li>Wait a few seconds</li>
</ul>
<p>Fold it all in Vim with the shortcut <code>zM</code> and unfold the top level with <code>za</code>.
You will see next. Highlighted lines are folded and their sing-column on the left show the <code>+</code> sign (or <code>â”‚+</code>, <code>â”‚â”‚+</code>, etc.).</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>-   0 {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+  1   &#34;age_names&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+  2   &#34;civ_helptexts&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+  3   &#34;civ_names&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+  4   &#34;data&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+  5   &#34;tech_tree_strings&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+  6   &#34;techtrees&#34;: {
</span></span><span style="display:flex;"><span>â”‚   7 }
</span></span></code></pre></div><p>Move your cursor to the <code>&quot;data&quot;</code> object and unfold it with <code>za</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>-    4 {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+   3   &#34;age_names&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+   2   &#34;civ_helptexts&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+   1   &#34;civ_names&#34;: {
</span></span><span style="display:flex;"><span>â”‚-   0   &#34;data&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚+  1     &#34;buildings&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚+  2     &#34;node_types&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚+  3     &#34;techs&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚+  4     &#34;unit_upgrades&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚+  5     &#34;units&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚   6   },
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+   7   &#34;tech_tree_strings&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚+   8   &#34;techtrees&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚    9 }
</span></span></code></pre></div><p>Navigate to the <code>&quot;buildings&quot;</code> object and unfold it with <code>za</code>.
Then move to the first element, the <code>&quot;12&quot;</code> and unscroll it too.</p>
<p>It&rsquo;s displayed like next, though I edited it a bit for clarity.</p>
<ul>
<li><code>[...]</code> represent omitted lines.</li>
<li>Thus, some line numbers [relative to the line of the cursor] are shown as <code>..</code>.</li>
<li>The highlighted lines are now only for the folded ones inside the <code>&quot;buildings&quot;</code> object, to keep focus.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>-      6 {
</span></span><span style="display:flex;"><span>â”‚+     5   &#34;age_names&#34;: {
</span></span><span style="display:flex;"><span>â”‚+     4   &#34;civ_helptexts&#34;: {
</span></span><span style="display:flex;"><span>â”‚+     3   &#34;civ_names&#34;: {
</span></span><span style="display:flex;"><span>â”‚-     2   &#34;data&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚-    1     &#34;buildings&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚-   0       &#34;12&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚   1         &#34;AccuracyPercent&#34;: 0,
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚â”‚â”‚+  2         &#34;Armours&#34;: [
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚   3         &#34;Attack&#34;: 0,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚   4         &#34;Attacks&#34;: [],
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚â”‚â”‚+  5         &#34;Cost&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚   6         &#34;GarrisonCapacity&#34;: 10,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚   7         &#34;HP&#34;: 1200,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚   8         &#34;ID&#34;: 12,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚   9         &#34;LanguageHelpId&#34;: 26135,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  10         &#34;LanguageNameId&#34;: 5135,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  11         &#34;LineOfSight&#34;: 6,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  12         &#34;MeleeArmor&#34;: 0,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  13         &#34;MinRange&#34;: 0,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  14         &#34;PierceArmor&#34;: 7,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  15         &#34;Range&#34;: 0,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  16         &#34;ReloadTime&#34;: 0,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  17         &#34;TrainTime&#34;: 50,
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  18         &#34;internal_name&#34;: &#34;Barracks Age1&#34;
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚â”‚  19       },
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚â”‚+  20       &#34;45&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚â”‚+  21       &#34;49&#34;: {
</span></span><span style="display:flex; background-color:#19404a"><span>â”‚â”‚â”‚+  ..       [...]
</span></span><span style="display:flex;"><span>â”‚â”‚â”‚   ..     },
</span></span><span style="display:flex;"><span>â”‚â”‚+   ..     &#34;node_types&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚+   ..     &#34;techs&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚+   ..     &#34;unit_upgrades&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚+   ..     &#34;units&#34;: {
</span></span><span style="display:flex;"><span>â”‚â”‚    ..   },
</span></span><span style="display:flex;"><span>â”‚+    ..   &#34;tech_tree_strings&#34;: {
</span></span><span style="display:flex;"><span>â”‚+    ..   &#34;techtrees&#34;: {
</span></span><span style="display:flex;"><span>â”‚     .. }
</span></span></code></pre></div><p>We only aim to get for each building its icon image. For the barracks we can already get it:</p>
<ul>
<li>The <code>&quot;internal_name&quot;</code> field is <code>&quot;Barracks Age1&quot;</code>.</li>
<li>The <code>&quot;12&quot;</code> in <code>.data.buildings[&quot;12&quot;]</code> acts as an ID of icons,
the <a href="https://github.com/SiegeEngineers/aoe2techtree/blob/master/img/Buildings/12.png"><code>img/Buildings/12.png</code></a> displayed below.</li>
<li>It might seen redudant, but <code>.data.buildings[&quot;12&quot;]</code> has the <code>.data.buildings[&quot;12&quot;].ID</code> with value <code>12</code>.</li>
</ul>
<p><a href="https://github.com/SiegeEngineers/aoe2techtree/blob/master/img/Buildings/12.png"><img src="https://raw.githubusercontent.com/SiegeEngineers/aoe2techtree/master/img/Buildings/12.png" alt="Barracks Age1"></a></p>
<p>Sidenote. <a href="https://github.com/phelipetls/jsonpath.nvim">jsonpath.nvim</a> is a Vim plugin that sends to clipboard the JSON path where the cursor is.
Watch its showcasting, as well as many other plugin features,
in my <a href="https://github.com/juanMarinero/vim-plugins-screenshots?tab=readme-ov-file#vim-markdown">vim-plugins-screenshots</a> repo.</p>
<h4 id="the-jq-command">The jq command</h4>
<p>We overviewed the AOE2 <em>buildings</em>, lets inspect now the <em>units</em>.</p>
<p>Vim is awesome, but to avoid repetitive tools lets give a chance to the <a href="https://stedolan.github.io/jq/"><code>jq</code></a> command.</p>
<p>Get the keys of the <code>&quot;units&quot;</code> object.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#b58900">cd</span> data/aoe2techtree/data/
</span></span><span style="display:flex;"><span>jq -r <span style="color:#2aa198">&#39;.data.units | keys[]&#39;</span> data.json <span style="color:#586e75"># unsorted keys</span>
</span></span><span style="display:flex;"><span>jq -r <span style="color:#2aa198">&#39;.data.units | keys | map(tonumber) | sort | map(tostring)[]&#39;</span> data.json
</span></span></code></pre></div><p>The first one is <code>&quot;4&quot;</code>. The respective JSON object is returned via:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq <span style="color:#2aa198">&#39;.data.units[&#34;4&#34;]&#39;</span> data.json
</span></span></code></pre></div><p>Note, to get the n-th value simply apply next syntax, no need to get and sort all the keys initally. <code>[0]</code> means the first element.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>jq <span style="color:#2aa198">&#39;.data.units | to_entries | .[0] | .value&#39;</span> data.json
</span></span></code></pre></div><p>Both last commands ouput the same result.</p>

<details>
  <summary><code>.data.units[&quot;4&quot;]</code> - Click to expand ðŸ“œ</summary>
  <div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;AccuracyPercent&#34;</span>: <span style="color:#2aa198">80</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Armours&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">4</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">15</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">3</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">31</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Attack&#34;</span>: <span style="color:#2aa198">4</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;AttackDelaySeconds&#34;</span>: <span style="color:#2aa198">0.35</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Attacks&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">27</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">21</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">4</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">3</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">17</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Amount&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#268bd2">&#34;Class&#34;</span>: <span style="color:#2aa198">13</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;BlastWidth&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;ChargeEvent&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;ChargeType&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Cost&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;Gold&#34;</span>: <span style="color:#2aa198">45</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#268bd2">&#34;Wood&#34;</span>: <span style="color:#2aa198">25</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;FrameDelay&#34;</span>: <span style="color:#2aa198">15</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;GarrisonCapacity&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;HP&#34;</span>: <span style="color:#2aa198">30</span>,
</span></span><span style="display:flex; background-color:#19404a"><span>  <span style="color:#268bd2">&#34;ID&#34;</span>: <span style="color:#2aa198">4</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;LanguageHelpId&#34;</span>: <span style="color:#2aa198">26083</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;LanguageNameId&#34;</span>: <span style="color:#2aa198">5083</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;LineOfSight&#34;</span>: <span style="color:#2aa198">6</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;MaxCharge&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;MeleeArmor&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;MinRange&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;PierceArmor&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Range&#34;</span>: <span style="color:#2aa198">4</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;RechargeRate&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;ReloadTime&#34;</span>: <span style="color:#2aa198">2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Speed&#34;</span>: <span style="color:#2aa198">0.96</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;TrainTime&#34;</span>: <span style="color:#2aa198">35</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;Trait&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">&#34;TraitPiece&#34;</span>: <span style="color:#2aa198">0</span>,
</span></span><span style="display:flex; background-color:#19404a"><span>  <span style="color:#268bd2">&#34;internal_name&#34;</span>: <span style="color:#2aa198">&#34;ARCHR&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></details>

<p>Therefore,</p>
<ul>
<li>The <code>&quot;internal_name&quot;</code> values <code>&quot;ARCHR&quot;</code>.</li>
<li>The <code>&quot;4&quot;</code> ID refers to the <a href="https://github.com/SiegeEngineers/aoe2techtree/blob/master/img/Units/4.png"><code>img/Units/4.png</code></a> below.</li>
<li>This number appears both in the JSON path <code>.data.units[&quot;4&quot;]</code> and in the value of <code>.data.units[&quot;4&quot;].ID</code>.</li>
</ul>
<p><a href="https://github.com/SiegeEngineers/aoe2techtree/blob/master/img/Units/4.png"><img src="https://raw.githubusercontent.com/SiegeEngineers/aoe2techtree/master/img/Units/4.png" alt="ARCHR"></a></p>
<h3 id="merge-the-structured-data">Merge the structured data</h3>
<h4 id="add-an-id-field-to-age-of-empires-ii-api">Add an ID field to age-of-empires-II-api</h4>
<p>Add an unique integer identifier field to a CSV file.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>add_id_column<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">input_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">1</span><span style="color:#719e07">:-</span><span style="color:#268bd2">input</span>.csv<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">output_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">2</span><span style="color:#719e07">:-</span><span style="color:#268bd2">output</span>.csv<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">header_bool</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">3</span><span style="color:#719e07">:-</span><span style="color:#268bd2">true</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Create a folder to store the processed data</span>
</span></span><span style="display:flex;"><span>  mkdir -p <span style="color:#719e07">$(</span>dirname <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">output_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">if</span> <span style="color:#719e07">[[</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$header_bool</span><span style="color:#2aa198">&#34;</span> <span style="color:#719e07">==</span> <span style="color:#b58900">true</span> <span style="color:#719e07">]]</span>; <span style="color:#719e07">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75"># Has header: add &#34;ID&#34; as first column and number from 1 below header</span>
</span></span><span style="display:flex;"><span>    awk -v <span style="color:#268bd2">header</span><span style="color:#719e07">=</span><span style="color:#2aa198">1</span> <span style="color:#2aa198">&#39;BEGIN {FS=OFS=&#34;,&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">      NR==1 {print &#34;ID&#34;, $0; next}
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">      {print NR-1, $0}
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">    &#39;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$input_file</span><span style="color:#2aa198">&#34;</span> &gt; <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$output_file</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#586e75"># No header: just add numbered ID starting at 1 for all rows</span>
</span></span><span style="display:flex;"><span>    awk <span style="color:#2aa198">&#39;BEGIN {FS=OFS=&#34;,&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">      {print NR, $0}
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">    &#39;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$input_file</span><span style="color:#2aa198">&#34;</span> &gt; <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$output_file</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Original data dir</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">aoe2apiDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/age-of-empires-II-api/data&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Processed data dir</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">bundleDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">processedDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/data/aoe2api/01_id_numeric&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Add ID to units</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">input_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">aoe2apiDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/units.csv&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">output_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">processedDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/units.csv&#34;</span>
</span></span><span style="display:flex;"><span>add_id_column <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">input_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">output_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Add ID to structures</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">input_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">aoe2apiDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">output_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">processedDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span>add_id_column <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">input_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">output_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Notice the new first field <code>ID</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">1</span><span>&gt; head &#34;${processedDir}/units.csv&#34;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">2</span><span>ID,name, description, expansion, age, [...]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">3</span><span>1,Archer, Quick and light. Weak at close range; excels at battle from distance, Age of Kings, [...]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">4</span><span>2,Crossbowman,Upgraded archer, Age of Kings,  [...]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">5</span><span>3,Arbalest,Upgraded crossbowman, Age of Kings, [...]
</span></span></code></pre></div><p>And analogous for the structures.</p>
<h4 id="get-the-unique-names">Get the unique names</h4>
<p>Lets focus on how to get the unique age-of-empires-II-api-<code>names</code>.</p>
<p>The <strong>unique identifier</strong> was <strong>not</strong> <code>name</code>.
E.g. <code>&quot;Eagle Warrior&quot;</code> is a <code>name</code>-value duplicated in
<a href="https://github.com/aalises/age-of-empires-II-api/blob/3ec582fa0ebd5ea11b2d1ff405e61836c6f3a99d/data/units.csv#L10"><code>units.csv</code></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csv" data-lang="csv"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span><span style="color:#2aa198">Eagle Warrior</span>,<span style="color:#2aa198">[...]</span>,<span style="color:#2aa198"> Barracks</span>,<span style="color:#2aa198"> {&#34;info&#34;:&#34;1 Unit free at the start of the game for Aztecs and Mayans&#34;}</span>,<span style="color:#2aa198"> 0</span>,<span style="color:#2aa198"> 2</span>,<span style="color:#2aa198"> 0</span>,<span style="color:#2aa198"> 1.1</span>,<span style="color:#2aa198"> 6</span>,<span style="color:#2aa198"> 50</span>,<span style="color:#2aa198"> 0</span>,<span style="color:#2aa198"> 4</span>,<span style="color:#2aa198"> 0/2</span>,<span style="color:#2aa198">+8 monks;+3 siege</span>,,,,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span><span><span style="color:#2aa198">Eagle Warrior</span>,<span style="color:#2aa198">[...]</span>,<span style="color:#2aa198"> Barracks</span>,<span style="color:#2aa198"> {&#34;Food&#34;: 20;&#34;Gold&#34;: 50}</span>,<span style="color:#2aa198"> 35</span>,<span style="color:#2aa198"> 2</span>,<span style="color:#2aa198"> 0</span>,<span style="color:#2aa198"> 1.1</span>,<span style="color:#2aa198"> 6</span>,<span style="color:#2aa198"> 50</span>,<span style="color:#2aa198"> 0</span>,<span style="color:#2aa198"> 7</span>,<span style="color:#2aa198"> 0/2</span>,<span style="color:#2aa198">+8 monks;+3 siege;+2 cavalry;+1 ship/camel</span>,,,,</span></span></code></pre></div>
<p>For AOE2 <em>units</em>, we can run next shell chunk. It applies basic CSV processing,</p>
<ul>
<li><code>cut -d',' -f1,2</code> to get the first column (<code>id</code>) and the second column (<code>names</code>)</li>
<li><code>sort</code> to both sort by <code>$field_unique</code> and make it <code>u</code>nique removing duplicated rows (lines with same value in this field)</li>
<li><code>tail -n +2</code> to remove the first line, the CSV header</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#719e07">function</span> getUniqueNames<span style="color:#719e07">()</span> <span style="color:#719e07">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Set default values</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">input_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">${</span><span style="color:#268bd2">1</span><span style="color:#719e07">:-</span><span style="color:#268bd2">file</span>.csv<span style="color:#2aa198">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">output_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">${</span><span style="color:#268bd2">2</span><span style="color:#719e07">:-</span><span style="color:#268bd2">names_not_duplicated</span>.csv<span style="color:#2aa198">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">field_numbers</span><span style="color:#719e07">=</span><span style="color:#2aa198">${</span><span style="color:#268bd2">3</span><span style="color:#719e07">:-</span><span style="color:#268bd2">1</span>,2<span style="color:#2aa198">}</span>  <span style="color:#586e75"># Fields to output</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">field_unique</span><span style="color:#719e07">=</span><span style="color:#2aa198">${</span><span style="color:#268bd2">4</span><span style="color:#719e07">:-</span><span style="color:#268bd2">2</span><span style="color:#2aa198">}</span>     <span style="color:#586e75"># Field for uniqueness</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Create a folder to store the processed data</span>
</span></span><span style="display:flex;"><span>  mkdir -p <span style="color:#719e07">$(</span>dirname <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">output_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Clear output file if it exists</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">[</span> -f <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$output_file</span><span style="color:#2aa198">&#34;</span> <span style="color:#719e07">]</span> <span style="color:#719e07">&amp;&amp;</span> <span style="color:#cb4b16">\r</span>m <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$output_file</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Get header row</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">new_header</span><span style="color:#719e07">=</span><span style="color:#719e07">$(</span>head -n <span style="color:#2aa198">1</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">input_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> | cut -d<span style="color:#2aa198">&#39;,&#39;</span> -f<span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">field_numbers</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Create temp file</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">tmp_file</span><span style="color:#719e07">=</span><span style="color:#719e07">$(</span>mktemp<span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Delete header</span>
</span></span><span style="display:flex;"><span>  cp <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$input_file</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$tmp_file</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  sed -i <span style="color:#2aa198">&#39;1d&#39;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$tmp_file</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Get data rows, keep both fields, then sort by the unique field and remove duplicates</span>
</span></span><span style="display:flex;"><span>  cat <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$tmp_file</span><span style="color:#2aa198">&#34;</span> | <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    cut -d<span style="color:#2aa198">&#39;,&#39;</span> -f<span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">field_numbers</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> | <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    sort -t<span style="color:#2aa198">&#39;,&#39;</span> -k<span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">field_unique</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> -u &gt;&gt; <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$output_file</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#586e75"># Add new header</span>
</span></span><span style="display:flex;"><span>  sed -i <span style="color:#2aa198">&#34;1i\\</span><span style="color:#268bd2">$new_header</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$output_file</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Original data dir</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">bundleDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">originalDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/data/aoe2api/01_id_numeric&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Processed data dir</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">processedDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/data/aoe2api/02_names_not_duplicated&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Get unique-sorted names of units</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">input_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">originalDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/units.csv&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">output_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">processedDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/units.csv&#34;</span>
</span></span><span style="display:flex;"><span>getUniqueNames <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">input_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">output_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Get unique-sorted names of structures</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">input_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">originalDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">output_file</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">processedDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span>getUniqueNames <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">input_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">output_file</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Results:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; head &#34;${processedDir}/units.csv&#34;
</span></span><span style="display:flex;"><span>ID,name
</span></span><span style="display:flex;"><span>3,Arbalest
</span></span><span style="display:flex;"><span>1,Archer
</span></span><span style="display:flex;"><span>54,Battering Ram
</span></span><span style="display:flex;"><span>69,Berserk
</span></span><span style="display:flex;"><span>50,Bombard Cannon
</span></span><span style="display:flex;"><span>59,Camel
</span></span><span style="display:flex;"><span>24,Cannon Galleon
</span></span><span style="display:flex;"><span>55,Capped Ram
</span></span><span style="display:flex;"><span>71,Cataphract
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; head &#34;${processedDir}/structures.csv&#34;
</span></span><span style="display:flex;"><span>ID,name
</span></span><span style="display:flex;"><span>10,Archery Range
</span></span><span style="display:flex;"><span>1,Barracks
</span></span><span style="display:flex;"><span>12,Blacksmith
</span></span><span style="display:flex;"><span>58,Bombard Tower
</span></span><span style="display:flex;"><span>24,Castle
</span></span><span style="display:flex;"><span>2,Dock
</span></span><span style="display:flex;"><span>3,Farm
</span></span><span style="display:flex;"><span>4,Fish Trap
</span></span><span style="display:flex;"><span>56,Fortified Wall
</span></span></code></pre></div><h4 id="simplify-the-aoe2techtree-data">Simplify the aoe2techtree data</h4>
<p>We need a JSON that collects from all the units next:</p>
<ul>
<li>The <code>&quot;internal_name&quot;</code> field.</li>
<li>The <code>&quot;ID&quot;</code> field.</li>
</ul>
<p>Another for the buildings too.</p>
<p><code>jq</code> in a <code>zsh</code> script is powerful enough to achieve this.</p>
<p>Clone the <a href="https://github.com/JuanMarinero/Hugo_AOE2_post_aux">Hugo_AOE2_post_aux</a> repository created expressly for current Hugo post.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">scriptDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$HOME</span><span style="color:#2aa198">/Downloads/Hugo_AOE2_post_aux&#34;</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/JuanMarinero/Hugo_AOE2_post_aux.git <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptDir</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Create a directory for the processed data.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Processed data dir</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">bundleDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">processedDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/data/aoe2techtree/01_names_icons_only&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">processedDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Run the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Make the script executable</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/source/aoe2techtreeGetDataIcons.sh&#34;</span>
</span></span><span style="display:flex;"><span>chmod +x <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptFile</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Path to original data</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">aoe2techtreeData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2techtree/data/data.json&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Get name-icon data for units and buildings</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">source</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptFile</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">aoe2techtreeData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">processedDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/units.csv&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">source</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptFile</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">aoe2techtreeData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">processedDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/structures.csv&#34;</span> <span style="color:#2aa198">&#34;.data.buildings&#34;</span>
</span></span></code></pre></div><p>Results:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; head &#34;${processedDir}/units.csv&#34;
</span></span><span style="display:flex;"><span>id, internal_name, language_name_id
</span></span><span style="display:flex;"><span>1001, ORGAN, 5129
</span></span><span style="display:flex;"><span>1003, EORGAN, 5130
</span></span><span style="display:flex;"><span>1004, CARAV, 5132
</span></span><span style="display:flex;"><span>1006, CARAV, 5133
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; head &#34;${processedDir}/structures.csv&#34;
</span></span><span style="display:flex;"><span>id, internal_name, language_name_id
</span></span><span style="display:flex;"><span>101, STBL, 5171
</span></span><span style="display:flex;"><span>1021, FEITO, 5159
</span></span><span style="display:flex;"><span>103, BLAC, 5131
</span></span></code></pre></div><h4 id="get-the-language-names">Get the language names</h4>
<p>We wil get the aoe2techtree-<code>language_names</code>.</p>
<p>Create a Python virtual environment <strong>outside your Hugo project</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Activate the virtual environment</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$HOME</span><span style="color:#2aa198">/Downloads/Hugo_AOE2_post_aux&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span><span style="color:#b58900">source</span> venv/bin/activate
</span></span><span style="display:flex;"><span>pip install -r requirements.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Return to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> -
</span></span></code></pre></div><p>Convert <code>aoe2techtree</code>-<code>language_names</code> data to CSV.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Assign the script to a variable</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/source/json2csv.py&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Call it</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data/aoe2techtree&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csvMergedLanguageNames</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/language_names.csv&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">json</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2techtree/data/locales/en/strings.json&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">columns</span><span style="color:#719e07">=(</span><span style="color:#2aa198">&#34;ID&#34;</span> <span style="color:#2aa198">&#34;language_name&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>python <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptFile</span><span style="color:#2aa198">&#34;</span> --json-path <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$json</span><span style="color:#2aa198">&#34;</span> --csv-path <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMergedLanguageNames</span><span style="color:#2aa198">&#34;</span> --columns <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">columns</span>[@]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>head <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMergedLanguageNames</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Prints the first records:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>ID,language_name
</span></span><span style="display:flex;"><span>1,
</span></span><span style="display:flex;"><span>1001,Age of Empires II
</span></span><span style="display:flex;"><span>4201,Dark Age
</span></span><span style="display:flex;"><span>4202,Feudal Age
</span></span><span style="display:flex;"><span>4203,Castle Age
</span></span><span style="display:flex;"><span>4204,Imperial Age
</span></span><span style="display:flex;"><span>5009,Steppe Lancer
</span></span><span style="display:flex;"><span>5010,Elite Steppe Lancer
</span></span><span style="display:flex;"><span>5033,Composite Bowman
</span></span></code></pre></div><p>Next adds the <code>language_name</code> field to new <code>units</code> and <code>structures</code> CSV files.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Assign the script to a variable</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/source/merge_csv_files.py&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Call it</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data/aoe2techtree&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csv1Dir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/01_names_icons_only&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csv2</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMergedLanguageNames</span><span style="color:#2aa198">&#34;</span> <span style="color:#586e75"># output of json2csv</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">resultDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/02_add_languages_names&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$resultDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csvs</span><span style="color:#719e07">=(</span><span style="color:#2aa198">&#34;units&#34;</span> <span style="color:#2aa198">&#34;structures&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">for</span> csv in <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csvs</span>[@]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv1</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv1Dir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csvMerged</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  python <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptFile</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv1</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv2</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --output <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMerged</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-field <span style="color:#2aa198">&#34;language_name_id&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-field <span style="color:#2aa198">&#34;ID&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">done</span>
</span></span></code></pre></div><p>The units and structures outputs are the respective dataframe heads:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>  id internal_name  language_name_id   language_name
</span></span><span style="display:flex;"><span>1001         ORGAN              5129       Organ Gun
</span></span><span style="display:flex;"><span>1003        EORGAN              5130 Elite Organ Gun
</span></span><span style="display:flex;"><span>1004         CARAV              5132         Caravel
</span></span><span style="display:flex;"><span>1006         CARAV              5133   Elite Caravel
</span></span><span style="display:flex;"><span>1007         CAMAR              5134    Camel Archer
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>  id internal_name  language_name_id language_name
</span></span><span style="display:flex;"><span> 101          STBL              5171        Stable
</span></span><span style="display:flex;"><span>1021         FEITO              5159      Feitoria
</span></span><span style="display:flex;"><span> 103          BLAC              5131    Blacksmith
</span></span><span style="display:flex;"><span> 104          CRCH              5138     Monastery
</span></span><span style="display:flex;"><span> 109          RTWC              5164   Town Center
</span></span></code></pre></div><p>Notice that the default merge (<code>--join-type</code> flag) is <code>left</code>,
thus we execute a code alike <code>pd.merge(df1, df2, [...], how='left')</code>.
The reason is that we want to keep the original data no matter if it lacks the repsective <code>language_name</code>.</p>
<p>Luckily, both script echo that there are no rows with null values found.
This will simplify the next step.</p>
<h4 id="linked-data-between-api-s">Linked data between API-s</h4>
<p>The unique names of AOE2 <em>units</em> are in a subfolder of <code>content/en/aoe2_cheatsheet/data/</code>, specifically:</p>
<ul>
<li><code>aoe2techtree/02_add_languages_names/units.csv</code> for the aoe2techtree with fields <code>id</code>, <code>internal_name</code>, <code>language_name_id</code> and <code>language_name</code></li>
<li><code>aoe2api/02_names_not_duplicated/units.csv</code> for the aoe2api with fields <code>ID</code> and <code>name</code></li>
</ul>
<p>We must find out how to link them.</p>
<p>For <em>buildings</em>/<em>structures</em> it&rsquo;s the same respective directory. The corresponding JSON files <em>basename</em> is here <code>structures.json</code>.</p>
<p>Activate your Python virtual environment</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Navigate to venv</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$HOME</span><span style="color:#2aa198">/Downloads/Hugo_AOE2_post_aux&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Source</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">source</span> venv/bin/activate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Assign the script to a variable</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/source/fuzzymerge.py&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Return to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> -
</span></span></code></pre></div><p>Run the fuzzy merge code.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">subfolders</span><span style="color:#719e07">=(</span><span style="color:#2aa198">&#34;02_names_not_duplicated&#34;</span> <span style="color:#2aa198">&#34;02_add_languages_names&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">resultDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/01_fuzzymerge&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$resultDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csvs</span><span style="color:#719e07">=(</span><span style="color:#2aa198">&#34;units&#34;</span> <span style="color:#2aa198">&#34;structures&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">fieldsSuffix</span><span style="color:#719e07">=(</span><span style="color:#2aa198">&#34;aoe2api&#34;</span> <span style="color:#2aa198">&#34;aoe2techtree&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">for</span> csv in <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csvs</span>[@]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv1</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">fieldsSuffix</span>[1]<span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">subfolders</span>[1]<span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv2</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">fieldsSuffix</span>[2]<span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">subfolders</span>[2]<span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">results</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  python <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptFile</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv1</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv2</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-id-col <span style="color:#2aa198">&#34;ID&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-id-col <span style="color:#2aa198">&#34;language_name_id&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-name-col <span style="color:#2aa198">&#34;name&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-name-col <span style="color:#2aa198">&#34;language_name&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-field-suffix <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">fieldsSuffix</span>[1]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-field-suffix <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">fieldsSuffix</span>[2]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --output <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$results</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">done</span>
</span></span></code></pre></div><p>Inspect the worst matches in-between the <code>name_aoe2api</code> and <code>language_name_aoe2techtree</code>,
i.e. the lowest values in the <code>match score</code> column.
E.g. for buildings:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; { head -n 1 &#34;$results&#34;; tail -n 10 &#34;$results&#34;; } | column -t -s,
</span></span><span style="display:flex;"><span>name_aoe2api    lang[...]_aoe2techtree  ID_aoe2api  lang[...]_aoe2techtree  match_score
</span></span><span style="display:flex;"><span>Gate            Palisade Gate           53          5186                    90
</span></span><span style="display:flex;"><span>Fortified Wall  Fortified Church        56          5038                    74
</span></span><span style="display:flex;"><span>Keep            Krepost                 59          5349                    68
</span></span><span style="display:flex;"><span>Castle          Pasture                 24          5895                    62
</span></span><span style="display:flex;"><span>Fish Trap       Feitoria                4           5159                    59
</span></span><span style="display:flex;"><span>Farm            Folwark                 3           5581                    55
</span></span><span style="display:flex;"><span>Castle          Mule Cart               24          5045                    54
</span></span><span style="display:flex;"><span>Guard Tower     Harbor                  57          5249                    47
</span></span><span style="display:flex;"><span>Dock            Donjon                  2           5544                    45
</span></span><span style="display:flex;"><span>Barracks        Caravanserai            1           5440                    45
</span></span></code></pre></div><p>Notes:</p>
<ul>
<li>Shrunk header for display. The column names are <code>name_aoe2api</code>, <code>language_name_aoe2techtree</code>, <code>ID_aoe2api</code>, <code>language_name_id_aoe2techtree</code> and <code>match_score</code>.</li>
<li>The fields are self-explanatory, except the <code>match_score</code>.</li>
<li>The <em>name</em>-ish columns are consequitiv (the two on the left) to quickly spot the imperfect matches by eye.</li>
<li>The higher match score, the better. We can edit the minimum value in the call with the <code>--threshold</code> flag from 0 (default) to 100.</li>
</ul>
<p>Can this script be called in whatever two CSV files we want?
<strong>No</strong>, each CSV must have:</p>
<ul>
<li>An identifier field, for later unique reference.</li>
<li>And two string columns for the fuzzy match.</li>
</ul>
<p>What did this script perform?</p>
<ul>
<li>It looped each <code>--name-col</code> item in the <code>--csv2</code>, in this case each <code>language_name</code> value [of each row] of the AOE2TechTree CSV (encapsulating units or buildings).</li>
<li>Since we previously sorted this data alphabetically, then the result loop will also be in the alphabetical order of this column.</li>
<li>We choose the AOE2TechTree data as <code>--csv2</code> because we want to find a match for each of its icons in the AOE2API data, and not necessary vice versa.</li>
<li>In each looped <a href="https://github.com/seatgeek/fuzzywuzzy"><code>fuzzywuzzy</code></a> tries to find its best <strong>fuzzy match</strong> in the column <code>name</code> of the other CSV (<code>--csv1</code>), the AOE2API data.</li>
<li>Each iteration finishes recording the best result and correspondings pairs of ID-s and name-s.</li>
<li>Finally, some rows of the AOE2API CSV (<code>--csv1</code>) might have not been best matched in the loop. We append them to the end of the final CSV.
With no values for the respectives AOE2API ID-s and names. No match score eiter.</li>
<li>This no matched rows are kept for consistency with the original CSVs.
And because in later data mining steps we might want to work with them.
As we will see, the fuzzy match results are far from perfect.</li>
</ul>
<h4 id="merge-the-icons">Merge the icons</h4>
<p>Wrapping up, in <code>content/en/aoe2_cheatsheet/data/</code> we have:</p>
<ul>
<li><code>aoe2techtree/02_add_languages_names/&lt;units|structures&gt;.csv</code>-fields are <code>id</code>, <code>internal_name</code>, <code>language_name_id</code> and <code>language_name</code></li>
<li><code>aoe2api-aoe2techtree/01_fuzzymerge/&lt;units|structures&gt;.csv</code> with header <code>name_aoe2api</code>, <code>language_name_aoe2techtree</code>, <code>ID_aoe2api</code>, <code>language_name_id_aoe2techtree</code> and <code>match_score</code>.</li>
</ul>
<p>With real data is easier to understand. Lets observe a single record, the second for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>CSV_display_vert<span style="color:#719e07">(){</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">csv</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$1</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">local</span> <span style="color:#268bd2">row</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$2</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  paste -d<span style="color:#2aa198">&#39;\t&#39;</span> &lt;<span style="color:#719e07">(</span>head -n1 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv</span><span style="color:#2aa198">&#34;</span> | tr <span style="color:#2aa198">&#39;,&#39;</span> <span style="color:#2aa198">&#39;\n&#39;</span><span style="color:#719e07">)</span> &lt;<span style="color:#719e07">(</span>sed -n <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$row</span><span style="color:#2aa198">&#34;</span>p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv</span><span style="color:#2aa198">&#34;</span> | tr <span style="color:#2aa198">&#39;,&#39;</span> <span style="color:#2aa198">&#39;\n&#39;</span><span style="color:#719e07">)</span> | column -ts <span style="color:#2aa198">$&#39;\t&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; CSV_display_vert &#34;${bundleDirData}/aoe2techtree/02_add_languages_names/structures.csv&#34; 2
</span></span><span style="display:flex;"><span>id                101
</span></span><span style="display:flex;"><span>internal_name     STBL
</span></span><span style="display:flex;"><span>language_name_id  5171
</span></span><span style="display:flex;"><span>language_name     Stable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; CSV_display_vert &#34;${bundleDirData}/aoe2api-aoe2techtree/01_fuzzymerge/structures.csv&#34; 2
</span></span><span style="display:flex;"><span>name_aoe2api                   Stable
</span></span><span style="display:flex;"><span>language_name_aoe2techtree     Stable
</span></span><span style="display:flex;"><span>ID_aoe2api                     19
</span></span><span style="display:flex;"><span>language_name_id_aoe2techtree  5171
</span></span><span style="display:flex;"><span>match_score                    100
</span></span></code></pre></div><p>Remember that the <code>id</code> of <code>aoe2techtree/02_add_languages_names</code> is the key to render icons.</p>
<p>We shall join these datasets by:</p>
<ul>
<li><code>language_name_id</code> of <code>aoe2techtree/02_add_languages_names</code></li>
<li>With <code>language_name_id_aoe2techtree</code> of <code>aoe2api-aoe2techtree/01_fuzzymerge</code></li>
</ul>
<p>Activate your Python virtual environment and get the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Navigate to venv</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$HOME</span><span style="color:#2aa198">/Downloads/Hugo_AOE2_post_aux&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Source</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">source</span> venv/bin/activate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Assign the script to a variable</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/source/merge_csv_files.py&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Return to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> -
</span></span></code></pre></div><p>Run next.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csv1Dir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2techtree/02_add_languages_names&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csv2Dir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/01_fuzzymerge&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">resultDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/02_icon_merge&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$resultDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csvs</span><span style="color:#719e07">=(</span><span style="color:#2aa198">&#34;units&#34;</span> <span style="color:#2aa198">&#34;structures&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">for</span> csv in <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csvs</span>[@]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv1</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv1Dir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv2</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv2Dir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csvMerged</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  python <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptFile</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv1</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv2</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-field <span style="color:#2aa198">&#34;language_name_id&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-field <span style="color:#2aa198">&#34;language_name_id_aoe2techtree&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-field-remove <span style="color:#2aa198">&#34;False&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-field-remove <span style="color:#2aa198">&#34;False&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --join-type <span style="color:#2aa198">&#34;inner&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --output <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMerged</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">done</span>
</span></span></code></pre></div><p>For buildings we get for example next record.
We keep all fields.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; CSV_display_vert &#34;$csvMerged&#34; 2
</span></span><span style="display:flex;"><span>id                             101
</span></span><span style="display:flex;"><span>internal_name                  STBL
</span></span><span style="display:flex;"><span>language_name_id               5171
</span></span><span style="display:flex;"><span>language_name                  Stable
</span></span><span style="display:flex;"><span>name_aoe2api                   Stable
</span></span><span style="display:flex;"><span>language_name_aoe2techtree     Stable
</span></span><span style="display:flex;"><span>ID_aoe2api                     19
</span></span><span style="display:flex;"><span>language_name_id_aoe2techtree  5171
</span></span><span style="display:flex;"><span>match_score                    100
</span></span></code></pre></div><p>Now we want unique icons and sort by match score.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#719e07">for</span> csv in <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csvs</span>[@]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csvMerged</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">inputFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMerged</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">outputFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/unique_icon/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#719e07">$(</span>dirname <span style="color:#268bd2">$outputFile</span><span style="color:#719e07">)</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  python3 -c <span style="color:#2aa198">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">import pandas as pd;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">import sys;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Create dataframe
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">inputfile = sys.argv[1];
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df = pd.read_csv(inputfile);
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Reorder and skip colums
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># - language_name_aoe2techtree col is duplicated
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># - name_aoe2api to the first column to compare with the rendered icon easily
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># - language_name then to compare strings with previous column
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># - ID_aoe2api and id side by side to notate ID-s of pairs to discard
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df = df[[&#39;name_aoe2api&#39;, &#39;language_name&#39;, &#39;ID_aoe2api&#39;, &#39;id&#39;, &#39;match_score&#39;]]
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Sort the result by match_score descending
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df.sort_values(&#39;match_score&#39;, ascending=False, inplace=True)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Drop duplicates
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df.drop_duplicates(subset=[&#39;id&#39;], keep=&#39;first&#39;, inplace=True)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Output
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">outfile = sys.argv[2];
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df.to_csv(outfile, index=False)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Print
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">print(df.head(10).to_string(index=False))
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">&#34;</span> <span style="color:#268bd2">$inputFile</span> <span style="color:#268bd2">$outputFile</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">done</span>
</span></span></code></pre></div><h4 id="manual-matches">Manual matches</h4>
<p>The above script does not give us the best possible matches.</p>
<p>We check it visually thanks to a custom Hugo shortcode that renders a CSV as a HTML-table and even display an image for each row.
Details in previous sections:</p>
<ul>
<li><a href="/blogs/hugo_shortcode_csv_to_table/#hugo-layout-for-jumbo-landscape-elements">Hugo layout for jumbo landscape elements</a></li>
<li>And <a href="/blogs/hugo_shortcode_csv_to_table/#shortcodes">Shortcodes</a></li>
</ul>
<p>Since the previous merged CSV is stored in
<code>content/en/aoe2_cheatsheet/data/aoe2api-aoe2techtree/02_icon_merge/unique_icon/structures.csv</code>,
we use the <code>csv-to-table-imgs</code> shortcode with the following call in a markdown:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">csv-to-table-imgs</span>
</span></span><span style="display:flex;"><span>  path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2api-aoe2techtree/02_icon_merge/unique_icon/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span>  img_path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/images/aoe2techtree/img/Buildings&#34;</span>
</span></span><span style="display:flex;"><span>  img_field<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>&gt;}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">csv-to-table-imgs</span>
</span></span><span style="display:flex;"><span>  path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2api-aoe2techtree/02_icon_merge/unique_icon/units.csv&#34;</span>
</span></span><span style="display:flex;"><span>  img_path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/images/aoe2techtree/img/Units&#34;</span>
</span></span><span style="display:flex;"><span>  img_field<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>&gt;}}
</span></span></code></pre></div><p>See it <a href="/aoe2_cheatsheet/#adding-the-icon">here</a>.</p>
<p>Screenshot:</p>

<details>
  <summary>Click to expand the screenshot</summary>
  <img src="/images/blogs/hugo_shortcode_CSV_to_table/02_icon_merge__unique_icons__structures.png" alt="02_icon_merge__unique_icons__structures.png" style="width:95%;"></details>

<p>Well, we will do some manual matches:</p>
<ul>
<li>For each row check if the icon displayed in the <code>ID_aoe2techtree-img-rendered</code> columns makes sense with the <code>name_aoe2api</code> column.
These two are one after the other for convienience.</li>
<li>If the match seems wrong, then search the proper value among the <code>name_aoe2api</code>-s.
Find its corresponding <code>ID_aoe2api</code> and take a note of the new [<code>ID_aoe2techtree</code>, <code>ID_aoe2api</code>] pair.</li>
</ul>
<p>Results. Next associated records are wrong.</p>
<table>
  <thead>
      <tr>
          <th>name_aoe2api</th>
          <th>language_name</th>
          <th>ID_aoe2api</th>
          <th>id</th>
          <th>match_score</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Fortified Wall</td>
          <td>Fortified Church</td>
          <td>56</td>
          <td>1806</td>
          <td>74</td>
      </tr>
      <tr>
          <td>Keep</td>
          <td>Krepost</td>
          <td>59</td>
          <td>1251</td>
          <td>68</td>
      </tr>
      <tr>
          <td>Castle</td>
          <td>Pasture</td>
          <td>24</td>
          <td>1889</td>
          <td>62</td>
      </tr>
      <tr>
          <td>Fish Trap</td>
          <td>Feitoria</td>
          <td>4</td>
          <td>1021</td>
          <td>59</td>
      </tr>
      <tr>
          <td>Farm</td>
          <td>Folwark</td>
          <td>3</td>
          <td>1734</td>
          <td>55</td>
      </tr>
      <tr>
          <td>Castle Mule</td>
          <td>Cart</td>
          <td>24</td>
          <td>1808</td>
          <td>54</td>
      </tr>
      <tr>
          <td>Guard Tower</td>
          <td>Harbor</td>
          <td>57</td>
          <td>1189</td>
          <td>47</td>
      </tr>
      <tr>
          <td>Dock</td>
          <td>Donjon</td>
          <td>2</td>
          <td>1665</td>
          <td>45</td>
      </tr>
      <tr>
          <td>Barracks</td>
          <td>Caravanserai</td>
          <td>1</td>
          <td>1754</td>
          <td>45</td>
      </tr>
  </tbody>
</table>
<p>Thus, we must overwrite the following [<code>ID_aoe2techtree</code>, <code>ID_aoe2api</code>] pairs,
in all these cases with a <code>NULL</code> value since no other row of AOE2API matches the AOE2TechTree image (nor name).</p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>ID_aoe2api</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1806</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>1251</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>1889</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>1021</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>1734</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>1808</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>1189</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>1665</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>1754</td>
          <td>NULL</td>
      </tr>
  </tbody>
</table>
<p>We apply the same algorithm to the units.</p>
<p>Once finished pass the dict <code>reassign_maps</code> of new best matches to next script.</p>
<p>Activate your Python virtual environment and get the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Navigate to venv</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$HOME</span><span style="color:#2aa198">/Downloads/Hugo_AOE2_post_aux&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Source</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">source</span> venv/bin/activate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Assign the script to a variable</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/source/get_ID_mapping.py&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Return to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> -
</span></span></code></pre></div><p>And run:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">inputDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/02_icon_merge&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">resultDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/03_ID_mapping&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$resultDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># TODO complete units-dict</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csvs</span><span style="color:#719e07">=(</span>units structures<span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">reassign_maps</span><span style="color:#719e07">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#39;{1263: null, 1129: null, 1889: null,  873: null,  875: null, 1007: null, 1009: null, 1970: null, 1968: null, 1923: null, 1230: null, 1255: null}&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#39;{1806: null, 1251: null, 1889: null, 1021: null, 1734: null, 1808: null, 1189: null, 1665: null, 1754: null}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">for</span> i in <span style="color:#719e07">{</span>1..<span style="color:#2aa198">${#</span><span style="color:#268bd2">csvs</span><span style="color:#2aa198">}</span><span style="color:#719e07">}</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csvs</span>[<span style="color:#268bd2">$i</span>]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">reassign_map</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">reassign_maps</span>[<span style="color:#268bd2">$i</span>]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">input</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">inputDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">result</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#b58900">echo</span> <span style="color:#2aa198">&#34;Processing </span><span style="color:#268bd2">$csv</span><span style="color:#2aa198"> with reassign-map: </span><span style="color:#268bd2">$reassign_map</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  python <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptFile</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --input <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$input</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --output <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$result</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --id1-field <span style="color:#2aa198">&#34;id&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --id2-field <span style="color:#2aa198">&#34;ID_aoe2api&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --reassign-maps <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$reassign_map</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">done</span>
</span></span></code></pre></div><p>For buildings we get for example next record.
We keep all fields.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&gt; head $result
</span></span><span style="display:flex;"><span>id,ID_aoe2api
</span></span><span style="display:flex;"><span>101,19
</span></span><span style="display:flex;"><span>1021,
</span></span><span style="display:flex;"><span>103,12
</span></span><span style="display:flex;"><span>104,31
</span></span><span style="display:flex;"><span>109,9
</span></span><span style="display:flex;"><span>117,54
</span></span><span style="display:flex;"><span>1189,
</span></span><span style="display:flex;"><span>1251,
</span></span><span style="display:flex;"><span>12,1
</span></span></code></pre></div><p>Units joining is a bit more complicated. Too many records that fuzzy match algorithm is unable to associate.</p>
<p>I think it&rsquo;s too much for manual intervention.
Therefore, we shall ignore the AOE2 units from now on.
Though the remaining code chunks will act as we would still be insterested in them.</p>
<h3 id="hotkeys">Hotkeys</h3>
<h4 id="create-a-hotkey-table">Create a hotkey table</h4>
<p>For the <em>AOE2 Definitive Edition</em> the default hotkey layout follows the QWERTY layout.</p>
<p><a href="https://forums.ageofempires.com/t/few-things-i-want-to-see-in-aoe2/136931"><img src="https://forums.ageofempires.com/uploads/default/original/3X/c/d/cdd44f9552594ae70fd45e2a982aafcaf6bd7706.jpeg" alt="QWERTY hotkeys economic buildings"></a></p>
<p>E.g. to build an structure one must:</p>
<ol>
<li>Select Villager/s</li>
<li>Press <code>Q</code> for economic buildings, <code>W</code> for military</li>
<li>Press corresponding hotkey: Barracks <code>Q</code>, Archery <code>W</code>,&hellip;</li>
</ol>
<p>We will create a hotkey table only on the buildings. We had next rendered table:</p>

<details>
  <summary>Click to expand the screenshot</summary>
  <img src="/images/blogs/hugo_shortcode_CSV_to_table/02_icon_merge__unique_icons__structures.png" alt="02_icon_merge__unique_icons__structures.png" style="width:95%;"></details>

<p>Well, we will do some manual matches:</p>
<ul>
<li>Read the name of the icon, e.g. <code>Stable</code>. So we know that the first hotkey is <code>W</code> (military building).</li>
<li>Annotate the <code>id</code> (the <code>ID_aoe2techtree</code>), e.g. <code>101</code></li>
<li>Find out the respective hotkey. For example go to <a href="https://ageofempires.fandom.com/wiki/Hotkey#Definitive_Edition_2">ageofempires.fandom hotkeys</a> and look for <code>Stable</code>.
Thus, we next next key-value pairs: <code>101: W + E</code></li>
</ul>
<p>Write results to next CSV file.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Processed data dir</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># New data dir</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">aoe2techtreeHotkeysDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$bundleDirData</span><span style="color:#2aa198">/aoe2techtree-hotkeys/&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$aoe2techtreeHotkeysDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Buildings</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csvFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$aoe2techtreeHotkeysDir</span><span style="color:#2aa198">/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">$EDITOR</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvFile</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csv" data-lang="csv"><span style="display:flex;"><span><span style="color:#2aa198">id</span>,<span style="color:#2aa198">hotkey1</span>,<span style="color:#2aa198">hotkey2</span>,<span style="color:#2aa198">select</span>
</span></span><span style="display:flex;"><span><span style="color:#2aa198">101</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">E</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">103</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">S</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">104</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">F</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">235</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">F</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">234</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">F</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">109</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">Z</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">71</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">Z</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">621</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">Z</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">155</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">D</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">117</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">D</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">12</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">Q</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">487</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">Z</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">199</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">Fishing-ship</span>
</span></span><span style="display:flex;"><span><span style="color:#2aa198">79</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">F</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">209</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">G</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">72</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">S</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">45</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">T</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">1189</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">T</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">276</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">X</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">236</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">G</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">50</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">A</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">49</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">R</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">562</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">R</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">598</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">A</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">584</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">E</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">87</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">W</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">82</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">C</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">70</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">Q</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">84</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">D</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">68</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">W</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">792</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">X</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">1806</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">F</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">1251</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">T</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">1021</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">C</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">1734</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">I</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">1808</span>,<span style="color:#2aa198">Q</span>,<span style="color:#2aa198">R</span>,<span style="color:#2aa198">Market</span>
</span></span><span style="display:flex;"><span><span style="color:#2aa198">1665</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">T</span>,
</span></span><span style="display:flex;"><span><span style="color:#2aa198">1754</span>,<span style="color:#2aa198">W</span>,<span style="color:#2aa198">C</span>,
</span></span></code></pre></div><h4 id="merge">Merge</h4>
<p>Activate your Python virtual environment and get the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#586e75"># Navigate to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> &lt;project_root&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Navigate to venv</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$HOME</span><span style="color:#2aa198">/Downloads/Hugo_AOE2_post_aux&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Source</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">source</span> venv/bin/activate
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Assign the script to a variable</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">scriptFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">scriptDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/source/merge_csv_files.py&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Return to project root</span>
</span></span><span style="display:flex;"><span><span style="color:#b58900">cd</span> -
</span></span></code></pre></div><p>And run:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csv1Dir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/03_ID_mapping&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csv2Dir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2techtree-hotkeys/&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">resultDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/04_shortcuts_merge&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$resultDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csvs</span><span style="color:#719e07">=(</span><span style="color:#2aa198">&#34;units&#34;</span> <span style="color:#2aa198">&#34;structures&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">for</span> csv in <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csvs</span>[@]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv1</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv1Dir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv2</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv2Dir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csvMerged</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">if</span> <span style="color:#719e07">[[</span> ! -e <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv2</span><span style="color:#2aa198">&#34;</span> <span style="color:#719e07">]]</span>; <span style="color:#719e07">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">continue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  python <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptFile</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv1</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv2</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-field <span style="color:#2aa198">&#34;id&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-field <span style="color:#2aa198">&#34;id&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-field-remove <span style="color:#2aa198">&#34;False&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-field-remove <span style="color:#2aa198">&#34;True&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --join-type <span style="color:#2aa198">&#34;left&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --output <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMerged</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">done</span>
</span></span></code></pre></div><p>The result dataframe head looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>  id  ID_aoe2api hotkey1 hotkey2 select
</span></span><span style="display:flex;"><span> 101        19.0       W       E    NaN
</span></span><span style="display:flex;"><span>1021         NaN       Q       C    NaN
</span></span><span style="display:flex;"><span> 103        12.0       Q       S    NaN
</span></span><span style="display:flex;"><span> 104        31.0       Q       F    NaN
</span></span></code></pre></div><p>Notice the implicit type coercion of the <code>ID_aoe2api</code> column because of the missing values.
Undo it:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#719e07">for</span> csv in <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csvs</span>[@]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csvMerged</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">if</span> <span style="color:#719e07">[[</span> ! -e <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMerged</span><span style="color:#2aa198">&#34;</span> <span style="color:#719e07">]]</span>; <span style="color:#719e07">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">continue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">inputFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMerged</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">outputFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMerged</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>  python3 -c <span style="color:#2aa198">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">import pandas as pd;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">import sys;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Create dataframe
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">inputfile = sys.argv[1];
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df = pd.read_csv(inputfile);
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Nullable integer. Hold integer values alongside NA (missing values) without upcasting to float 
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df[&#39;ID_aoe2api&#39;] = df[&#39;ID_aoe2api&#39;].astype(&#39;Int64&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Output
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">outfile = sys.argv[2]; df.to_csv(outfile, index=False)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Print
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">print(df.head(10).to_string(index=False))
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">&#34;</span> <span style="color:#268bd2">$inputFile</span> <span style="color:#268bd2">$outputFile</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">done</span>
</span></span></code></pre></div><p>Now both ID columns are integers.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>  id  ID_aoe2api hotkey1 hotkey2 select
</span></span><span style="display:flex;"><span> 101          19       W       E    NaN
</span></span><span style="display:flex;"><span>1021        &lt;NA&gt;       Q       C    NaN
</span></span><span style="display:flex;"><span> 103          12       Q       S    NaN
</span></span><span style="display:flex;"><span> 104          31       W       F    NaN
</span></span></code></pre></div><p>Preview the icons with the <code>csv-to-table-imgs</code> shortcode:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">csv-to-table-imgs</span>
</span></span><span style="display:flex;"><span>  path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2api-aoe2techtree/04_shortcuts_merge/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span>  img_path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/images/aoe2techtree/img/Buildings&#34;</span>
</span></span><span style="display:flex;"><span>  img_field<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>&gt;}}
</span></span></code></pre></div><p>See it <a href="/aoe2_cheatsheet/#with-shortcut">here</a>.</p>
<h4 id="add-the-aoe2api-fields">Add the AOE2API fields</h4>
<p>Previous table has:</p>
<ul>
<li><code>id</code> from AOE2TechTree of <code>aoe2api-aoe2techtree</code></li>
<li><code>ID_aoe2api</code> from AOE2API of <code>aoe2api-aoe2techtree</code></li>
<li>Hotkeys from <code>aoe2techtree-hotkeys</code></li>
</ul>
<p>Lets add all the AOE2API fields:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csv1Dir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/04_shortcuts_merge&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csv2Dir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api/01_id_numeric&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">resultDir</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/05_add_aoe2api_fields&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$resultDir</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">csvs</span><span style="color:#719e07">=(</span><span style="color:#2aa198">&#34;units&#34;</span> <span style="color:#2aa198">&#34;structures&#34;</span><span style="color:#719e07">)</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">for</span> csv in <span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csvs</span>[@]<span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>; <span style="color:#719e07">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv1</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv1Dir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csv2</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv2Dir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#268bd2">csvMerged</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">resultDir</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">.csv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">if</span> <span style="color:#719e07">[[</span> ! -e <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv1</span><span style="color:#2aa198">&#34;</span> <span style="color:#719e07">]]</span>; <span style="color:#719e07">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">continue</span>
</span></span><span style="display:flex;"><span>  <span style="color:#719e07">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  python <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$scriptFile</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv1</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2 <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csv2</span><span style="color:#2aa198">&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-field <span style="color:#2aa198">&#34;ID_aoe2api&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-field <span style="color:#2aa198">&#34;ID&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv1-field-remove <span style="color:#2aa198">&#34;False&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --csv2-field-remove <span style="color:#2aa198">&#34;True&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --join-type <span style="color:#2aa198">&#34;left&#34;</span> <span style="color:#cb4b16">\
</span></span></span><span style="display:flex;"><span><span style="color:#cb4b16"></span>    --output <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$csvMerged</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">done</span>
</span></span></code></pre></div><p>We can render it via:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">csv-to-table-imgs</span>
</span></span><span style="display:flex;"><span>  path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2api-aoe2techtree/05_add_aoe2api_fields/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span>  img_path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/images/aoe2techtree/img/Buildings&#34;</span>
</span></span><span style="display:flex;"><span>  img_field<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>&gt;}}
</span></span></code></pre></div><p>See it <a href="/aoe2_cheatsheet/#with-aoe2api-fields">here</a>.</p>
<h4 id="final-result">Final result</h4>
<p>Final polished table for AOE2 structures:</p>
<ul>
<li>Sorted by QWERTY hotkeys and remove records with same shortcuts</li>
<li>Filter AOE2API most practical fields</li>
<li>Cast all float columns to integer</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#268bd2">csv</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;structures.csv&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">bundleDirData</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;content/en/aoe2_cheatsheet/data&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">inputFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/05_add_aoe2api_fields/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#268bd2">outputFile</span><span style="color:#719e07">=</span><span style="color:#2aa198">&#34;</span><span style="color:#2aa198">${</span><span style="color:#268bd2">bundleDirData</span><span style="color:#2aa198">}</span><span style="color:#2aa198">/aoe2api-aoe2techtree/06_filter/</span><span style="color:#2aa198">${</span><span style="color:#268bd2">csv</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#2aa198">&#34;</span><span style="color:#719e07">$(</span>dirname <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$outputFile</span><span style="color:#2aa198">&#34;</span><span style="color:#719e07">)</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python3 -c <span style="color:#2aa198">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">import pandas as pd
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">import sys
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">import os
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Check if input file exists
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">inputfile = sys.argv[1]
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">if not os.path.exists(inputfile):
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">    print(f&#39;Error: Input file {inputfile} does not exist&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">    sys.exit(1)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Create dataframe
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df = pd.read_csv(inputfile)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Remove whitespace from column names
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df.columns = df.columns.str.strip()
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Keep only the row with max &#39;ID_aoe2api&#39; in each group of hotkey1 &amp; hotkey2
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df.dropna(subset=[&#39;hotkey1&#39;, &#39;hotkey2&#39;], inplace=True)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Get idxmax for each group, ignoring groups with all NaNs in &#39;ID_aoe2api&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">idxmax_series = df.groupby([&#39;hotkey1&#39;, &#39;hotkey2&#39;])[&#39;ID_aoe2api&#39;].idxmax()
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Drop NaN indices which arise if group is all NaN in &#39;ID_aoe2api&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">idxmax_series = idxmax_series.dropna().astype(int)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Select rows by valid indices
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df_unique = df.loc[idxmax_series]
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Filter columns
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">cols = [&#39;id&#39;, &#39;hotkey1&#39;, &#39;hotkey2&#39;, &#39;cost&#39;, &#39;build_time&#39;, &#39;hit_points&#39;, &#39;line_of_sight&#39;, &#39;armor&#39;, &#39;range&#39;, &#39;special&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df_filtered = df_unique[cols]
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Nullable integer. Hold integer values alongside NA (missing values) without upcasting to float 
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">float_cols = df_filtered.select_dtypes(include=[&#39;float&#39;]).columns
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df_filtered[float_cols] = df_filtered[float_cols].astype(&#39;Int64&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Define sort orders
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">order1 = [&#39;Q&#39;, &#39;W&#39;]
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">order2 = list(&#39;&#39;.join([&#39;QWERTYUIOP&#39;, &#39;ASDFGHJKL&#39;, &#39;ZXCVBNM&#39;]))
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">order1_map = {k: i for i, k in enumerate(order1)}
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">order2_map = {k: i for i, k in enumerate(order2)}
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Sort by hotkey1 (Q/W) then hotkey2 (QWERTY order)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df_sorted = df_filtered.sort_values(
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">    by=[&#39;hotkey1&#39;, &#39;hotkey2&#39;],
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">    key=lambda col: col.map(order1_map if col.name == &#39;hotkey1&#39; else order2_map).fillna(len(order2))
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Output
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">outfile = sys.argv[2]
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">df_sorted.to_csv(outfile, index=False)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198"># Print first 10 rows
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">print(&#39;First 10 rows of sorted data:&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">print(df_sorted.head(10).to_string(index=False))
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$inputFile</span><span style="color:#2aa198">&#34;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$outputFile</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Finally replace resources words with emojis:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sed -i <span style="color:#2aa198">&#39;s/Wood/ðŸªµ/g&#39;</span>       <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$outputFile</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#2aa198">&#39;s/Stone/ðŸª¨/g&#39;</span>      <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$outputFile</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#2aa198">&#39;s/Gold/ðŸª™/g&#39;</span>       <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$outputFile</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#2aa198">&#39;s/Food/ðŸŒ¾/g&#39;</span>       <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$outputFile</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#2aa198">&#39;s/units/ðŸ‘¥/g&#39;</span>      <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$outputFile</span><span style="color:#2aa198">&#34;</span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#2aa198">&#39;s/population/ðŸ‘¥/g&#39;</span> <span style="color:#2aa198">&#34;</span><span style="color:#268bd2">$outputFile</span><span style="color:#2aa198">&#34;</span>
</span></span></code></pre></div><p>Render it:</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{&lt; <span style="color:#268bd2">csv-to-table-imgs</span>
</span></span><span style="display:flex;"><span>  path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;data/aoe2api-aoe2techtree/06_filter/structures.csv&#34;</span>
</span></span><span style="display:flex;"><span>  img_path<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;/images/aoe2techtree/img/Buildings&#34;</span>
</span></span><span style="display:flex;"><span>  img_field<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;id&#34;</span>
</span></span><span style="display:flex;"><span>  img_field_raw<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>&gt;}}
</span></span></code></pre></div><p>See it <a href="/aoe2_cheatsheet/#tldr">here</a>.</p>
<p>Screenshot:</p>
<img src="/images/blogs/hugo_shortcode_CSV_to_table/06_filter__structures.png" alt="06_filter__structures.png" style="width:95%;"><h3 id="bonus">Bonus</h3>
<p><strong>Hugo</strong> further readings:</p>
<ul>
<li><a href="https://hugoinaction.com/">Hugo in Action</a> chapter 9, <em>Accessing APIs to enhance functionality</em></li>
</ul>
<p><strong>AOE2</strong> guides and cheatsheets:</p>
<ul>
<li><a href="https://www.reddit.com/r/aoe2/comments/el8hvj/visual_build_order_cheatsheet_fast_castle_boom/">Fast Castle Boom</a></li>
<li><a href="https://ageofnotes.com/tutorials/complete-hotkeys-guide-for-age-of-empires-2-definitive/">Hotkeys Guide</a></li>
<li><a href="https://www.reddit.com/r/aoe2/comments/s63q04/aoe_ii_cheat_sheet_for_beginners/">Cheat sheets for custom hotkeys</a></li>
<li><a href="https://ageofempires.fandom.com/wiki/Hotkey">ageofempires.fandom hotkeys</a></li>
</ul>
<h4 id="imagination-is-the-limit">Imagination is the limit</h4>
<h5 id="hugo-shortcode-to-render-a-table-with-images">Hugo shortcode to render a table with images</h5>
<p><code>csv-to-table-imgs.html</code> is can be further improved to get features like:</p>
<ul>
<li>Pass width and/or height of the images to render</li>
<li>Do not display every column but the ones in a list.
Hugo&rsquo;s <a href="/blogs/hugo_render_hooks/#code-block">code block</a> and
Hugo&rsquo;s <a href="/blogs/hugo_shortcodes/#highlight">highlight shortcode</a>
already accept a list of lines to highlight, e.g. <code>hl_lines=3 6-8</code>.
We can use their templates as reference.</li>
<li>Arbitray column to render the image, instead of the first one always.</li>
</ul>
<p>Or even reconsider the whole code to render multiple images from the same CSV data:</p>
<ul>
<li><code>$img_field</code> as a list of columns to be rendered as image</li>
<li><code>$img_path</code> would be the list of each image file location in the Hugo project</li>
<li><code>$img_format</code> their respective formats (e.g. <code>png</code> or <code>jpg</code>)</li>
<li><code>$caption</code> argument to stack the corresponding caption strings</li>
<li>Etc.</li>
</ul>
<h5 id="diagrams">Diagrams</h5>
<p>The <a href="https://www.reddit.com/r/aoe2/comments/el8hvj/visual_build_order_cheatsheet_fast_castle_boom/">Fast Castle Boom</a>
diagram is really cool.
But what if I tell you that Hugo can create it too? Even much more complex diagrams. Check,</p>
<ul>
<li><a href="/blogs/hugo_render_hooks/#codeblock-goat">GoAT</a> (Go ASCII Tool)</li>
<li><a href="/blogs/latex_for_webdev/#tikz">TikZ</a></li>
</ul>
<h5 id="table-re-sorted-or-re-grouped">Table re-sorted or re-grouped</h5>
<p>Our structures table displays useful information,
but instead of QWERTY sorted, we might want it grouped by building&rsquo;s category.
Like next:</p>

<details>
  <summary>Click to expand ðŸ“œ</summary>
  <ul>
<li>Resources
<ul>
<li>Mine [shortcut, cost, time to build,&hellip;]</li>
<li>Lumberjack</li>
<li>Mill</li>
<li>Farm</li>
<li>Fishtrap</li>
<li>&hellip;</li>
</ul>
</li>
<li>Civilian
<ul>
<li>House</li>
<li>Town center</li>
<li>University</li>
<li>&hellip;</li>
</ul>
</li>
<li>Military
<ul>
<li>Barracks</li>
<li>Archery</li>
<li>Stable</li>
<li>&hellip;</li>
</ul>
</li>
<li>Water
<ul>
<li>Dock</li>
</ul>
</li>
<li>&hellip;</li>
</ul>
</details>

<h5 id="focus-on-shortcuts">Focus on shortcuts</h5>
<p>Cheatsheet for shortcuts to generate units, find idle units, military formation,&hellip;</p>

<details>
  <summary>Click to expand ðŸ“œ</summary>
  <ul>
<li>Generate Civilian
<ul>
<li>Peasent: [Icon rendered, shortcut to pick a town center and create a villager]</li>
<li>Trader</li>
<li>Fishship</li>
</ul>
</li>
<li>Generate Warrior
<ul>
<li>Paladin-sh
<ul>
<li>Spear</li>
<li>Knight</li>
</ul>
</li>
<li>Archers
-&hellip;</li>
<li>Knights
-&hellip;
Castle
<ul>
<li>Special</li>
<li>Trebuchet
Asedio
-&hellip;
Ships</li>
<li>&hellip;
Monks</li>
</ul>
</li>
</ul>
</li>
<li>Idle
<ul>
<li>Civilian ,ðŸ’¤ðŸªšðŸªµ</li>
<li>Warrior ðŸ’¤âš”ï¸</li>
</ul>
</li>
<li>Armee</li>
<li>Agresion status (??)
<ul>
<li>Passive ðŸ•Šï¸</li>
<li>Surround watch</li>
<li>Aggressive</li>
</ul>
</li>
<li>Formation
<ul>
<li>fila</li>
<li>cuadrado concÃ©ntrico</li>
<li>difuminado</li>
<li>en 2 grupos</li>
</ul>
</li>
<li>Misscelaneos:
<ul>
<li>Seq. Action: Ctrl</li>
<li>Circle movement ðŸ”„</li>
<li>Stop âœ‹</li>
</ul>
</li>
</ul>
</details>



<div class="html-content">
  <br>
  <a id="back-to-blogs-index" href="/blogs_index"><i class="fa fa-chevron-left" aria-hidden="true"></i> Blogs</a> 
  <br>
  <a id="back-to-main-page" href="/"><i class="fa fa-chevron-left" aria-hidden="true"></i>J. Marinero - Data Scientist & AI Engineer</a>
  <br>
</div>



      </section>
    </article>
  </main>




<footer class="site-footer">
  <div class="inner">
    
    <section class="links">
      <ol>
      
        <li>
          <a href="/license/">License</a>
        </li>
      
      </ol>
    </section>
    <hr />
    

    
      <section class="icons">
        
          <a href="tel:&#43;&#43;34%20616%2042%2036%2034" aria-label=''><i class="fa fa-phone"></i></a>
        
          <a href="mailto:juan.g.marinero@gmail.com" aria-label=''><i class="fa fa-envelope"></i></a>
        
          <a href="https://github.com/juanMarinero" aria-label=''><i class="fa-brands fa-github"></i></a>
        
          <a href="https://www.linkedin.com/in/juanmarinero/" aria-label=''><i class="fa-brands fa-linkedin"></i></a>
        
          <a href="https://juan-marinero.info/" aria-label=''><i class="fa fa-globe"></i></a>
        
      </section>
    

    
      <section class="copyright">Juan Gabriel Marinero Tarazona</section>
    

    

    
  </div>
</footer>


    

    
    
    
    

    <script src="/js/script.min.e853a4dfd899ef0f5749c33d64e2388119f4f8f866221b83ae75f840abec921a.js" integrity="sha256-6FOk39iZ7w9XScM9ZOI4gRn0&#43;PhmIhuDrnX4QKvskho=" ></script>

    
    <script>cssVars();</script>

    
</body>
</html>
